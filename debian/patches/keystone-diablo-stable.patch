diff -Naur keystone/AUTHORS keystone-new/AUTHORS
--- keystone/AUTHORS	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/AUTHORS	2011-11-15 14:12:31.000000000 -0600
@@ -16,12 +16,13 @@
 John Eo <joon.eo@gmail.com>
 Jorge L. Williams <jorge.williams@rackspace.com>
 Josh Kearney <josh@jk0.org>
+Julien Danjou <julien.danjou@enovance.com>
 Kevin L. Mitchell <kevin.mitchell@rackspace.com>
 Khaled Hussein <khaled.hussein@gmail.com>
 Mark Gius <mgius7096@gmail.com>
 Mark McLoughlin <markmc@redhat.com>
 Monty Taylor <mordred@inaugust.com>
-Paul VOccio <paul@substation9.com>
+Paul Voccio <paul@substation9.com>
 Ramana Juvvadi <rjuvvadi@hcl.com>
 Robin Norwood <robin.norwood@gmail.com>
 root <root@newapps.(none)>
@@ -29,6 +30,7 @@
 Sirish Bitra <sirish.bitra@gmail.com>
 Sony K. Philip <sony@hcleai.com>
 termie <github@anarkystic.com>
+Thierry Carrez <thierry@openstack.org>
 Todd Willey <xtoddx@gmail.com>
 Vishvananda Ishaya <vishvananda@gmail.com>
 Yogeshwar Srikrishnan <yoga80@yahoo.com>
diff -Naur keystone/bin/keystone keystone-new/bin/keystone
--- keystone/bin/keystone	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/bin/keystone	2011-11-15 14:12:31.000000000 -0600
@@ -34,7 +34,7 @@
 if os.path.exists(os.path.join(possible_topdir, 'keystone', '__init__.py')):
     sys.path.insert(0, possible_topdir)
 
-import keystone.tools.tracer # @UnusedImport # module runs on import
+import keystone.tools.tracer  # @UnusedImport # module runs on import
 import keystone
 from keystone.common import config, wsgi
 
diff -Naur keystone/bin/keystone-admin keystone-new/bin/keystone-admin
--- keystone/bin/keystone-admin	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/bin/keystone-admin	2011-11-15 14:11:29.000000000 -0600
@@ -34,7 +34,7 @@
 if os.path.exists(os.path.join(possible_topdir, 'keystone', '__init__.py')):
     sys.path.insert(0, possible_topdir)
 
-import keystone.tools.tracer # @UnusedImport # module runs on import
+import keystone.tools.tracer  # @UnusedImport # module runs on import
 import keystone
 from keystone.common import config, wsgi
 
diff -Naur keystone/bin/keystone-auth keystone-new/bin/keystone-auth
--- keystone/bin/keystone-auth	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/bin/keystone-auth	2011-11-15 14:11:29.000000000 -0600
@@ -34,7 +34,7 @@
 if os.path.exists(os.path.join(possible_topdir, 'keystone', '__init__.py')):
     sys.path.insert(0, possible_topdir)
 
-import keystone.tools.tracer # @UnusedImport # module runs on import
+import keystone.tools.tracer  # @UnusedImport # module runs on import
 import keystone
 from keystone.common import config, wsgi
 
diff -Naur keystone/bin/keystone-import keystone-new/bin/keystone-import
--- keystone/bin/keystone-import	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/bin/keystone-import	2011-11-15 14:11:29.000000000 -0600
@@ -13,10 +13,11 @@
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and 
+# See the License for the specific language governing permissions and
 # limitations under the License.
 
-# This file is to read a export file from Nova that will import users, tenants and EC2 credentials 
+# This file is to read a export file from Nova that will import users,
+# tenants and EC2 credentials
 # The file should be in the keystone-manage format
 
 import os
diff -Naur keystone/doc/generate_autodoc_index.py keystone-new/doc/generate_autodoc_index.py
--- keystone/doc/generate_autodoc_index.py	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/generate_autodoc_index.py	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,68 @@
+#!/usr/bin/env python
+"""Generates files for sphinx documentation using a simple Autodoc based
+template.
+
+To use, just run as a script:
+    $ python doc/generate_autodoc_index.py
+"""
+
+import os
+
+
+base_dir = os.path.dirname(os.path.abspath(__file__))
+RSTDIR=os.path.join(base_dir, "source", "sourcecode")
+SOURCEDIR=os.path.join(base_dir, "..")
+
+# Exclude these modules front the autodoc results
+EXCLUDE_MODULES = ['keystone.backends.sqlalchemy.migrate_repo.manage']
+
+def find_autodoc_modules(module_name, sourcedir):
+    """returns a list of modules in the SOURCE directory"""
+    modlist = []
+    os.chdir(os.path.join(sourcedir, module_name))
+    print "SEARCHING %s" % os.path.join(sourcedir, module_name)
+    for root, dirs, files in os.walk("."):
+        for filename in files:
+            if filename.endswith(".py"):
+                # root = ./keystone/test/unit
+                # filename = base.py
+                elements = root.split(os.path.sep)
+                # replace the leading "." with the module name
+                elements[0] = module_name
+                # and get the base module name
+                base, extension = os.path.splitext(filename)
+                if not (base == "__init__"):
+                    elements.append(base)
+                result = (".".join(elements))
+                if result not in EXCLUDE_MODULES:
+                    print result
+                    modlist.append(result)
+    return modlist
+
+if not(os.path.exists(RSTDIR)):
+    os.mkdir(RSTDIR)
+
+INDEXOUT = open("%s/autoindex.rst" % RSTDIR, "w")
+INDEXOUT.write("Source Code Index\n")
+INDEXOUT.write("=================\n")
+INDEXOUT.write(".. toctree::\n")
+INDEXOUT.write("   :maxdepth: 1\n")
+INDEXOUT.write("\n")
+
+for module in find_autodoc_modules('keystone', SOURCEDIR):
+    generated_file = "%s/%s.rst" % (RSTDIR, module)
+    print "Generating %s" % generated_file
+
+    INDEXOUT.write("   %s\n" % module)
+    FILEOUT = open(generated_file, "w")
+    FILEOUT.write("The :mod:`%s` Module\n" % module)
+    FILEOUT.write("=============================="
+                  "=============================="
+                  "==============================\n")
+    FILEOUT.write(".. automodule:: %s\n" % module)
+    FILEOUT.write("  :members:\n")
+    FILEOUT.write("  :undoc-members:\n")
+    FILEOUT.write("  :show-inheritance:\n")
+    FILEOUT.close()
+
+INDEXOUT.close()
diff -Naur keystone/doc/README.rst keystone-new/doc/README.rst
--- keystone/doc/README.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/README.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,38 @@
+==================================
+Building Contributor Documentation
+==================================
+
+This documentation is written by contributors, for contributors.
+
+The source is maintained in the `doc/source` folder using
+`reStructuredText`_ and built by `Sphinx`_ (a dependency from `tools/pip-requires`).
+
+.. _reStructuredText: http://docutils.sourceforge.net/rst.html
+.. _Sphinx: http://sphinx.pocoo.org/
+
+Building automatically
+======================
+
+From the project root, just type::
+
+    $ python setup.py build_sphinx
+
+Building manually
+=================
+
+#. Generate the code.rst file so that Sphinx will pull in our docstrings::
+
+    $ python doc/generate_autodoc_index.py
+
+#. Use `sphinx-build` to produce the docs in HTML::
+
+    $ sphinx-build -b html doc/source/ build/sphinx/html/
+
+#. Similarly, build the man pages (optional)::
+
+    $ sphinx-build -b man doc/source/ build/sphinx/man/
+
+After building
+==============
+
+Navigate to the `build/sphinx/html` directory to browse generated the HTML docs.
diff -Naur keystone/doc/source/adminAPI_curl_examples.rst keystone-new/doc/source/adminAPI_curl_examples.rst
--- keystone/doc/source/adminAPI_curl_examples.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/adminAPI_curl_examples.rst	2011-11-15 14:12:31.000000000 -0600
@@ -14,110 +14,320 @@
       License for the specific language governing permissions and limitations
       under the License.
 
-Curl Admin API examples
-=======================
+=============================
+Admin API Examples Using Curl
+=============================
+
+These examples assume a default port value of 35357, and depend on the
+``sampledata`` bundled with keystone.
 
-All examples assume default port usage (35357) and use the example admin account created
-on the Getting Started page.
+GET /
+=====
 
-Initial GET 
-#############
-Retrieves version, full API url, pdf doc link, and wadl link::
+Disover API version information, links to documentation (PDF, HTML, WADL),
+and supported media types::
 
-$> curl http://0.0.0.0:35357
+    $ curl http://0.0.0.0:35357
 
 or::
 
-$> curl http://0.0.0.0:35357/v2.0/
+    $ curl http://0.0.0.0:35357/v2.0/
+
+Returns::
+
+    {
+        "version":{
+            "id":"v2.0",
+            "status":"ALPHA",
+            "updated":"2011-11-19T00:00:00Z",
+            "links":[
+                {
+                    "rel":"self",
+                    "href":"http://127.0.0.1:35357/v2.0/"
+                },
+                {
+                    "rel":"describedby",
+                    "type":"text/html",
+                    "href":"http://docs.openstack.org/api/openstack-identity-service/2.0/content/"
+                },
+                {
+                    "rel":"describedby",
+                    "type":"application/pdf",
+                    "href":"http://docs.openstack.org/api/openstack-identity-service/2.0/identity-dev-guide-2.0.pdf"
+                },
+                {
+                    "rel":"describedby",
+                    "type":"application/vnd.sun.wadl+xml",
+                    "href":"http://127.0.0.1:35357/v2.0/identity-admin.wadl"
+                }
+            ],
+            "media-types":[
+                {
+                    "base":"application/xml",
+                    "type":"application/vnd.openstack.identity-v2.0+xml"
+                },
+                {
+                    "base":"application/json",
+                    "type":"application/vnd.openstack.identity-v2.0+json"
+                }
+            ]
+        }
+    }
+
+GET /extensions
+===============
+
+Discover the API extensions enabled at the endpoint::
+
+    $ curl http://0.0.0.0:35357/extensions
+
+Returns::
+
+    {
+        "extensions":{
+            "values":[]
+        }
+    }
+
+POST /tokens
+============
+
+Authenticate by exchanging credentials for an access token::
+
+    $ curl -d '{"auth":{"passwordCredentials":{"username": "joeuser", "password": "secrete"}}}' -H "Content-type: application/json" http://localhost:35357/v2.0/tokens
+
+Returns::
+
+    {
+        "access":{
+            "token":{
+                "expires":"2012-02-05T00:00:00",
+                "id":"887665443383838",
+                "tenant":{
+                    "id":"1",
+                    "name":"customer-x"
+                }
+            },
+            "serviceCatalog":[
+                {
+                    "endpoints":[
+                    {
+                        "adminURL":"http://swift.admin-nets.local:8080/",
+                        "region":"RegionOne",
+                        "internalURL":"http://127.0.0.1:8080/v1/AUTH_1",
+                        "publicURL":"http://swift.publicinternets.com/v1/AUTH_1"
+                    }
+                    ],
+                    "type":"object-store",
+                    "name":"swift"
+                },
+                {
+                    "endpoints":[
+                    {
+                        "adminURL":"http://cdn.admin-nets.local/v1.1/1",
+                        "region":"RegionOne",
+                        "internalURL":"http://127.0.0.1:7777/v1.1/1",
+                        "publicURL":"http://cdn.publicinternets.com/v1.1/1"
+                    }
+                    ],
+                    "type":"object-store",
+                    "name":"cdn"
+                }
+            ],
+            "user":{
+                "id":"1",
+                "roles":[
+                    {
+                    "tenantId":"1",
+                    "id":"3",
+                    "name":"Member"
+                    }
+                ],
+                "name":"joeuser"
+            }
+        }
+    }
+
+.. note::
+
+    Take note of the value ['access']['token']['id'] value produced here (``887665443383838``, above), as you can use it in the calls below.
+
+GET /tokens/{token_id}
+======================
+
+.. note::
+
+    This call refers to a token known to be valid, ``887665443383838`` in this case.
+
+Validate a token::
+
+    $ curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tokens/887665443383838
+
+If the token is valid, returns::
+
+    {
+        "access":{
+            "token":{
+                "expires":"2012-02-05T00:00:00",
+                "id":"887665443383838",
+                "tenant":{
+                    "id":"1",
+                    "name":"customer-x"
+                }
+            },
+            "user":{
+                "username":"joeuser",
+                "tenantName":"customer-x",
+                "id":"1",
+                "roles":[
+                    {
+                    "tenantId":"1",
+                    "id":"3",
+                    "name":"Member"
+                    }
+                ],
+                "tenantId":"1"
+            }
+        }
+    }
+
+HEAD /tokens/{token_id}
+=======================
+
+This is a high-performance variant of the GET call documented above, which
+by definition, returns no response body::
+
+    $ curl -I -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tokens/887665443383838
+
+... which returns ``200``, indicating the token is valid::
 
+    HTTP/1.1 200 OK
+    Content-Length: 0
+    Content-Type: None
+    Date: Tue, 08 Nov 2011 23:07:44 GMT
 
-Retrieve token:
-#####
-Retrieves the token and expiration date for a user::
+GET /tokens/{token_id}/endpoints
+================================
 
-	$> curl -d '{"passwordCredentials":{"username": "MyAdmin", "password": "P@ssw0rd"}}' -H "Content-type: application/json" http://localhost:35357/v2.0/tokens
+.. note::
+
+    Not implemented in stable/diablo! This resource is available in essex milestone 1.
+
+GET /tenants
+============
+
+List all of the tenants in the system (requires an Admin ``X-Auth-Token``)::
+
+    $ curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tenants
+
+Returns::
+
+    {
+        "tenants":{
+            "values":[
+                {
+                    "enabled":false,
+                    "description":"None",
+                    "name":"project-y",
+                    "id":"3"
+                },
+                {
+                    "enabled":true,
+                    "description":"None",
+                    "name":"ANOTHER:TENANT",
+                    "id":"2"
+                },
+                {
+                    "enabled":true,
+                    "description":"None",
+                    "name":"customer-x",
+                    "id":"1"
+                }
+            ],
+            "links":[
+
+            ]
+        }
+    }
+
+GET /tenants/{tenant_id}
+========================
+
+Retrieve information about a tenant, by tenant ID::
+
+    $ curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tenants/1
+
+Returns::
+
+    {
+        "tenant":{
+            "enabled":true,
+            "description":"None",
+            "name":"customer-x",
+            "id":"1"
+        }
+    }
+
+GET /tenants/{tenant_id}/users/{user_id}/roles
+==============================================
+
+.. note::
+
+    Not implemented in stable/diablo! This resource is available in essex milestone 1.
 
-This will return something like::
+List the roles a user has been granted on a tenant::
+
+    $ curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tenants/1/users/1/roles
+
+Returns::
+
+    {
+        "roles_links":[],
+        "roles":[
+            {
+                "id":"3",
+                "name":"Member"
+            }
+        ]
+    }
+
+GET /users/{user_id}
+====================
+
+Retrieve information about a user, by user ID::
+
+    $ curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/users/1
+
+Returns::
+
+    {
+        "user":{
+            "tenantId":"1",
+            "enabled":true,
+            "id":"1",
+            "name":"joeuser"
+        }
+    }
+
+GET /users/{user_id}/roles
+==========================
 
-	$> {"auth": {"token": {"expires": "2011-08-10T17:45:22.838440", "id": "0eed0ced-4667-4221-a0b2-24c91f242b0b"}}}
-	
 .. note::
 
-	Save the "id" as you'll be using it in the calls below.
+    Not implemented in stable/diablo! This resource is available in essex milestone 1.
+
+Retrieve the roles granted to a user, given a user ID::
 
+    $ curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/users/4/roles
 
-Retrieve a list of tenants:
-#####
-	Run:: 
-	
-	$> curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tenants
-
-This will return something like::
-
-	$> {"tenants": {"values": [{"enabled": 1, "id": "145", "name": "MyTenant", "description": null}], "links": []}}
-	
-Retrieve a list of users:
-#####
-	Run::
-	
-	$> curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/users
-	
-This will return something like::
-
-    $> {"users": {"values": [{"email": null, "enabled": true, "id": "1227", "name": "MyAdmin", "tenantId": "MyTenant"}], "links": []}}
-	
-Retrieve information about the token:
-#####
-	Run::
-	
-	$> curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tokens/0eed0ced-4667-4221-a0b2-24c91f242b0b
-		
-This will return something like::
-
-	$> {"auth": {"token": {"expires": "2011-08-11T04:26:58.145171", "id": "0eed0ced-4667-4221-a0b2-24c91f242b0b"}, "user": {"username": "MyAdmin", "roles": [{"roleId": "Admin", "id": 1}], "tenant": {"id": 932, "name": "MyTenant"}}}}	
-
-Revoking a token:
-#####	
-	Run::
-	
-	$> curl -X DELETE -H "X-Auth-Token:999888777666" http://localhost:35357/tokens/0eed0ced-4667-4221-a0b2-24c91f242b0b
-	
-Creating a tenant:
-#####
-	Run::
-	
-	$> curl -H "X-Auth-Token:999888777666" -H "Content-type: application/json" -d '{"tenant":{"id": 416, "name":"MyTenant2", "description":"My 2nd Tenant", "enabled":true}}'  http://localhost:35357/tenants
-	
-This will return something like::
-	
-	$> {"tenant": {"enabled": true, "id": "MyTenant2", "description": "My 2nd Tenant"}}
-	
-Verifying the tenant:
-#####
-	Run::
-	
-	$> curl -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tenants/MyTenant2
-	
-This will return something like::
-	
-	$> {"tenant": {"enabled": 1, "id": "MyTenant2", "description": "My 2nd Tenant"}}
-	
-Updating the tenant:
-#####
-	Run::
-	
-	$> curl -X PUT -H "X-Auth-Token:999888777666" -H "Content-type: application/json" -d '{"tenant":{"description":"My NEW 2nd Tenant"}}' http://localhost:35357/v2.0/tenants/MyTenant2
-	
-This will return something like::
-
-	$> {"tenant": {"enabled": true, "id": "MyTenant2", "description": "My NEW 2nd Tenant"}}		
-
-Deleting the tenant:
-#####
-	Run::
-	
-	$> curl -X DELETE -H "X-Auth-Token:999888777666" http://localhost:35357/v2.0/tenants/MyTenant2
-	
+Returns::
 
-    
-    
\ No newline at end of file
+    {
+        "roles_links":[],
+        "roles":[
+            {
+                "id":"2",
+                "name":"KeystoneServiceAdmin"
+            }
+        ]
+    }
diff -Naur keystone/doc/source/architecture.rst keystone-new/doc/source/architecture.rst
--- keystone/doc/source/architecture.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/architecture.rst	2011-11-15 14:11:29.000000000 -0600
@@ -17,3 +17,81 @@
 Keystone Architecture
 =====================
 
+Keystone has two major components: Authentication and a Service Catalog.
+
+Authentication
+--------------
+
+In providing a token-based authentication service for OpenStack, keystone
+has several major concepts:
+
+Tenant
+    A grouping used in OpenStack to contain relevant OpenStack services. A
+    tenant maps to a Nova "project-id", and in object storage, a tenant can
+    have multiple containers. Depending on the installation, a tenant can
+    represent a customer, account, organization, or project.
+
+User
+    Represents an individual within OpenStack for the purposes of
+    authenticating them to OpenStack services. Users have credentials, and may
+    be assigned to one or more tenants. When authenticated, a token is
+    provided that is specific to a single tenant.
+
+Credentials
+    Password or other information that uniquely identifies a User to Keystone
+    for the purposes of providing a token.
+
+Token
+    A token is an arbitrary bit of text that is used to share authentication
+    with other OpenStack services so that Keystone can provide a central
+    location for authenticating users for access to OpenStack services. A
+    token may be "scoped" or "unscoped". A scoped token represents a user
+    authenticated to a Tenant, where an unscoped token represents just the
+    user.
+
+    Tokens are valid for a limited amount of time and may be revoked at any
+    time.
+
+Role
+    A role is a set of permissions to access and use specific operations for
+    a given user when applied to a tenant. Roles are logical groupings of
+    those permissions to enable common permissions to be easily grouped and
+    bound to users associated with a given tenant.
+
+Service Catalog
+---------------
+
+Keystone also provides a list of REST API endpoints as a definitive list for
+an OpenStack installation. Key concepts include:
+
+Service
+    An OpenStack service such as nova, swift, glance, or keystone. A service
+    may have one of more endpoints through which users can interact with
+    OpenStack services and resources.
+
+Endpoint
+    A network accessible address (typically a URL) that represents the API
+    interface to an OpenStack service. Endpoints may also be grouped into
+    templates which represent a group of consumable OpenStack services
+    available across regions.
+
+Template
+    A collection of endpoints representing a set of consumable OpenStack
+    service endpoints.
+
+Components of Keystone
+----------------------
+
+Keystone includes a command-line interface which interacts with the Keystone
+API for administrating keystone and related services.
+
+* keystone - runs both keystone-admin and keystone-service
+* keystone-admin - the administrative API for manipulating keystone
+* keystone-service - the user oriented API for authentication
+* keystone-manage - the command line interface to manipulate keystone
+
+Keystone also includes WSGI middelware to provide authentication support
+for Nova and Swift.
+
+Keystone uses a built-in SQLite datastore - and may use an external LDAP
+service to authenticate users instead of using stored credentials.
diff -Naur keystone/doc/source/community.rst keystone-new/doc/source/community.rst
--- keystone/doc/source/community.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/community.rst	2011-11-15 14:11:29.000000000 -0600
@@ -14,6 +14,7 @@
       License for the specific language governing permissions and limitations
       under the License.
 
+================
 Getting Involved
 ================
 
@@ -21,14 +22,20 @@
 community. Feel free to ask questions. This document points you to some of the places where you can
 communicate with people.
 
-How to Join the Keystone Community
-----------------------------------
+How to Join the Community
+=========================
 
 Our community welcomes all people interested in open source cloud computing, and there are no formal
 membership requirements. The best way to join the community is to talk with others online or at a meetup
-and offer contributions through Launchpad, the wiki, or blogs. We welcome all types of contributions, 
-from blueprint designs to documentation to testing to deployment scripts. 
+and offer contributions through Launchpad_, the wiki_, or blogs. We welcome all types of contributions,
+from blueprint designs to documentation to testing to deployment scripts.
+
+.. _Launchpad: https://launchpad.net/keystone
+.. _wiki: http://wiki.openstack.org/
+
+Contributing Changes
+====================
 
-Contributing Code
------------------
+To contribute tests, docs, code, etc, refer to our `Gerrit-Jenkins-Github Workflow`_.
 
+.. _`Gerrit-Jenkins-Github Workflow`: http://wiki.openstack.org/GerritJenkinsGithub
diff -Naur keystone/doc/source/configuration.rst keystone-new/doc/source/configuration.rst
--- keystone/doc/source/configuration.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/configuration.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,277 @@
+..
+      Copyright 2011 OpenStack, LLC
+      All Rights Reserved.
+
+      Licensed under the Apache License, Version 2.0 (the "License"); you may
+      not use this file except in compliance with the License. You may obtain
+      a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+      Unless required by applicable law or agreed to in writing, software
+      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+      License for the specific language governing permissions and limitations
+      under the License.
+
+====================
+Configuring Keystone
+====================
+
+.. toctree::
+   :maxdepth: 1
+
+   keystone.conf
+   man/keystone-manage
+
+Once Keystone is installed, it needs to be configured with any services
+that will be using Keystone, and those services need to be provided with
+service tokens to be able to use Keystone to authenticate users.
+
+Setting up keystone credentials
+===============================
+
+The roles that are defined by default in the :doc:`keystone.conf` file are::
+
+    #Role that allows to perform admin operations.
+    keystone-admin-role = KeystoneAdmin
+
+    #Role that allows to perform service admin operations.
+    keystone-service-admin-role = KeystoneServiceAdmin
+
+Once configured, users and tenants need to be defined so that other OpenStack
+systems may authenticate against them. For the keystone service itself, two
+Roles are pre-defined in the keystone configuration file
+(:doc:`keystone.conf`).
+
+These roles still need to be created using :doc:`man/keystone-manage`
+commands to be able to use them::
+
+    $> keystone-manage user add admin secrete
+    $> keystone-manage role add KeystoneAdmin
+    $> keystone-manage role add KeystoneServiceAdmin
+    $> keystone-manage role grant KeystoneAdmin admin
+    $> keystone-manage role grant KeystoneServiceAdmin admin
+
+Once these are defined, you should now have the choice of using the
+administrative API (as well as the :doc:`man/keystone-manage` commands) to
+further configure keystone. There are a number of examples of how to use
+that API at :doc:`adminAPI_curl_examples`.
+
+Setting up service endpoints
+============================
+
+Defining an Administrative Service Token
+########################################
+
+An Administrative Service Token is a bit of arbitrary text which is configured
+in Keystone and used (typically configured into) Nova, Swift, Glance, and any
+other OpenStack projects, to be able to use Keystone services.
+
+This token is an arbitrary text string, but must be identical between Keystone
+and the services using Keystone. This token is bound to a user and tenant as
+well, so those also need to be created prior to setting it up.
+
+The *admin* user was set up above, but we haven't created a tenant for that
+user yet::
+
+    $> keystone-manage tenant add admin
+
+and while we're here, let's grant the admin user the 'Admin' role to the
+'admin' tenant::
+
+    $> keystone-manage role add Admin
+    $> keystone-manage role grant Admin admin admin
+
+Now we can create a service token::
+
+    $> keystone-manage token add 999888777666 admin admin 2015-02-05T00:00
+
+This creates a service token of '999888777666' associated to the admin user,
+admin tenant, and expires on February 5th, 2015. This token will be used when
+configuring Nova, Glance, or other OpenStack services.
+
+Defining Services and Service Endpoints
+#######################################
+
+Keystone also acts as a service catalog to let other OpenStack systems know
+where relevant API endpoints exist for OpenStack Services. The OpenStack
+Dashboard, in particular, uses this heavily - and this **must** be configured
+for the OpenStack Dashboard to properly function.
+
+Here's how we define the services::
+
+    $> keystone-manage service add nova compute "Nova Compute Service"
+    $> keystone-manage service add glance image "Glance Image Service"
+    $> keystone-manage service add swift storage "Swift Object Storage Service"
+    $> keystone-manage service add keystone identity "Keystone Identity Service"
+
+Once the services are defined, we create endpoints for them. Each service
+has three relevant URL's associated with it that are used in the command:
+
+* the public API URL
+* an administrative API URL
+* an internal URL
+
+The "internal URL" is a pointer to the same endpoint as the public API URL,
+but enabled for deployments which are using a private network to communicate
+between OpenStack components - where the 'public facing' API may not be
+available.
+
+An example of setting up the endpoint for Nova::
+
+    $> keystone-manage endpointTemplates add RegionOne nova \
+    http://nova-api.mydomain:8774/v1.1/ \
+    http://nova-api.mydomain:8774/v1.1/ \
+    http://nova-api.mydomain:8774/v1.1/ \
+    1 1
+
+Glance::
+
+    $> keystone-manage endpointTemplates add RegionOne glance \
+    http://glance.mydomain:9292/v1.1/ \
+    http://glance.mydomain:9292/v1.1/ \
+    http://glance.mydomain:9292/v1.1/ \
+    1 1
+
+Swift::
+
+    $> keystone-manage endpointTemplates add RegionOne swift \
+    http://swift.mydomain:8080/v1/AUTH_[TENANT_ID] \
+    http://swift.mydomain:8080/v1.0/ \
+    http://swift.mydomain:8080/v1/AUTH_[TENANT_ID] \
+    1 1
+
+And setting up an endpoint for Keystone::
+
+    $> keystone-manage endpointTemplates add RegionOne keystone \
+    http://keystone.mydomain:5000/v2.0 \
+    http://keystone.mydomain:35357/v2.0 \
+    http://keystone.mydomain:5000/v2.0 \
+    1 1
+
+
+Setting up OpenStack users
+==========================
+
+Creating Tenants, Users, and Roles
+##################################
+
+Let's set up a 'demo' tenant::
+
+    $> keystone-manage tenant add demo
+
+And add a 'demo' user with the password 'guest'::
+
+    $> keystone-manage user add demo guest
+
+Now let's add a role of "Member" and grant 'demo' user that role
+as it pertains to the tenant 'demo'::
+
+    $> keystone-manage role add Member
+    $> keystone-manage role grant Member demo demo
+
+Let's also add the admin user as an Admin role to the demo tenant::
+
+    $> keystone-manage role grant Admin admin demo
+
+Creating EC2 credentials
+########################
+
+To add EC2 credentials for the `admin` and `demo` accounts::
+
+    $> keystone-manage credentials add admin EC2 'admin' 'secretpassword'
+    $> keystone-manage credentials add admin EC2 'demo' 'secretpassword'
+
+If you have a large number of credentials to create, you can put them all
+into a single large file and import them using :doc:`man/keystone-import`. The
+format of the document looks like::
+
+    credentials add admin EC2 'username' 'password'
+    credentials add admin EC2 'username' 'password'
+
+Then use::
+
+    $> keystone-import `filename`
+
+Configuring Nova to use Keystone
+################################
+
+To configure Nova to use Keystone for authentication, the Nova API service
+can be run against the api-paste file provided by Keystone. This is most
+easily accomplished by setting the `--api_paste_config` flag in nova.conf to
+point to `examples/paste/nova-api-paste.ini` from Keystone. This paste file
+included references to the WSGI authentication middleware provided with the
+keystone installation.
+
+When configuring Nova, it is important to create a admin service token for
+the service (from the Configuration step above) and include that as the key
+'admin_token' in the nova-api-paste.ini. See the documented
+:doc:`nova-api-paste` file for references.
+
+Configuring Swift to use Keystone
+#################################
+
+Similar to Nova, swift can be configured to use Keystone for authentication
+rather than it's built in 'tempauth'.
+
+1. Add a service endpoint for Swift to Keystone
+
+2. Configure the paste file for swift-proxy (`/etc/swift/swift-proxy.conf`)
+
+3.  Reconfigure Swift's proxy server to use Keystone instead of TempAuth.
+    Here's an example `/etc/swift/proxy-server.conf`::
+
+        [DEFAULT]
+        bind_port = 8888
+        user = <user>
+
+        [pipeline:main]
+        pipeline = catch_errors cache keystone proxy-server
+
+        [app:proxy-server]
+        use = egg:swift#proxy
+        account_autocreate = true
+
+        [filter:keystone]
+        use = egg:keystone#tokenauth
+        auth_protocol = http
+        auth_host = 127.0.0.1
+        auth_port = 35357
+        admin_token = 999888777666
+        delay_auth_decision = 0
+        service_protocol = http
+        service_host = 127.0.0.1
+        service_port = 8100
+        service_pass = dTpw
+
+        [filter:cache]
+        use = egg:swift#memcache
+        set log_name = cache
+
+        [filter:catch_errors]
+        use = egg:swift#catch_errors
+
+4. Restart swift
+
+5. Verify that keystone is providing authentication to Swift
+
+Use `swift` to check everything works (note: you currently have to create a
+container or upload something as your first action to have the account
+created; there's a Swift bug to be fixed soon)::
+
+    $ swift -A http://127.0.0.1:5000/v1.0 -U joeuser -K secrete post container
+    $ swift -A http://127.0.0.1:5000/v1.0 -U joeuser -K secrete stat -v
+    StorageURL: http://127.0.0.1:8888/v1/AUTH_1234
+    Auth Token: 74ce1b05-e839-43b7-bd76-85ef178726c3
+    Account: AUTH_1234
+    Containers: 1
+    Objects: 0
+    Bytes: 0
+    Accept-Ranges: bytes
+    X-Trans-Id: tx25c1a6969d8f4372b63912f411de3c3b
+
+.. WARNING::
+    Keystone currently allows any valid token to do anything with any account.
+
+
diff -Naur keystone/doc/source/conf.py keystone-new/doc/source/conf.py
--- keystone/doc/source/conf.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/conf.py	2011-11-15 14:11:29.000000000 -0600
@@ -44,6 +44,7 @@
 # extensions coming with Sphinx (named 'sphinx.ext.*') or your custom ones.
 extensions = ['sphinx.ext.autodoc',
               'sphinx.ext.coverage',
+              'sphinx.ext.viewcode',
               'sphinx.ext.ifconfig',
               'sphinx.ext.intersphinx',
               'sphinx.ext.pngmath',
@@ -79,9 +80,9 @@
 # The short X.Y version.
 from keystone import version as keystone_version
 # The full version, including alpha/beta/rc tags.
-release = keystone_version
+release = keystone_version()
 # The short X.Y version.
-version = keystone_version
+version = keystone_version()
 
 # The language for content autogenerated by Sphinx. Refer to documentation
 # for a list of supported languages.
@@ -126,8 +127,18 @@
 # List of tuples 'sourcefile', 'target', u'title', u'Authors name', 'manual'
 
 man_pages = [
-    ('man/keystonemanage', 'keystone-manage', u'Keystone Management Utility',
-     [u'OpenStack'], 1)
+    ('man/keystone-manage', 'keystone-manage', u'Keystone Management Utility',
+     [u'OpenStack'], 1),
+    ('man/keystone', 'keystone', u'Keystone Startup Command',
+     [u'OpenStack'], 1),
+    ('man/keystone-auth', 'keystone-auth', u'Keystone Startup Command',
+     [u'OpenStack'], 1),
+    ('man/keystone-admin', 'keystone-admin', u'Keystone Startup Command',
+     [u'OpenStack'], 1),
+    ('man/keystone-import', 'keystone-import', u'Keystone Management Utility',
+     [u'OpenStack'], 1),
+    ('man/keystone-control', 'keystone-control',
+     u'Keystone Management Utility', [u'OpenStack'], 1)
  ]
 
 
diff -Naur keystone/doc/source/developing.rst keystone-new/doc/source/developing.rst
--- keystone/doc/source/developing.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/developing.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,139 @@
+..
+      Copyright 2011 OpenStack, LLC
+      All Rights Reserved.
+
+      Licensed under the Apache License, Version 2.0 (the "License"); you may
+      not use this file except in compliance with the License. You may obtain
+      a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+      Unless required by applicable law or agreed to in writing, software
+      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+      License for the specific language governing permissions and limitations
+      under the License.
+
+========================
+Developing with Keystone
+========================
+
+Get your development environment set up according to :doc:`setup`.
+
+Running a development instance
+==============================
+
+Setting up a virtualenv
+-----------------------
+
+We recommend establishing a virtualenv to run keystone within. To establish
+this environment, use the command::
+
+    $> python tools/install_venv.py
+
+This will create a local virtual environment in the directory ``.keystone-venv``.
+Once created, you can activate this virtualenv for your current shell using:
+
+    $> source .keystone-venv/bin/activate
+
+The virtual environment can be disabled using the command::
+
+    $> deactivate
+
+You can also use ``tools\with_venv.sh`` to prefix commands so that they run
+within the virtual environment. For more information on virtual environments,
+see virtualenv_.
+
+.. _virtualenv: http://www.virtualenv.org/
+
+Running Keystone
+----------------
+
+To run the keystone Admin and API server instances, use::
+
+    $> tools/with_venv.sh bin/keystone
+
+Running a demo service that uses Keystone
+-----------------------------------------
+To run client demo (with all auth middleware running locally on sample service):
+
+    $> tools/with_venv.sh examples/echo/bin/echod
+
+which spins up a simple "echo" service on port 8090. To use a simple echo client:
+
+    $> python examples/echo/echo_client.py
+
+Interacting with Keystone
+=========================
+
+You can interact with Keystone through the command line using :doc:`keystone-manage`
+which allows you to establish tenants, users, etc.
+
+You can also interact with Keystone through it's REST API. There is a python
+keystone client library python-keystoneclient_ which interacts exclusively through
+the REST API.
+
+.. _python-keystoneclient: https://github.com/4P/python-keystoneclient
+
+The easiest way to establish some base information in Keystone to interact with is
+to invoke::
+
+    $> tools/with_venv.sh bin/sampledata
+
+You can see the details of what that creates in ``keystone/test/sampledata.py``
+
+interacting with keystone using curl
+------------------------------------
+
+Get an unscoped token::
+
+    $> curl -d '{"auth": {"passwordCredentials": {"username": "joeuser", "password": "secrete"}}}' -H "Content-type: application/json" http://localhost:5000/v2.0/tokens
+
+Get a token for a tenant::
+
+    $> curl -d '{"auth": {"passwordCredentials": {"username": "joeuser", "password": "secrete"}, "tenantName": "customer-x"}}' -H "Content-type: application/json" http://localhost:5000/v2.0/tokens
+
+Get an admin token::
+
+    $> curl -d '{"auth": {"passwordCredentials": {"username": "admin", "password": "secrete"}}}' -H "Content-type: application/json" http://localhost:35357/v2.0/tokens
+
+Get a list of tenants using the admin token::
+
+    $> curl -d '{"auth": {"passwordCredentials": {"username": "admin", "password": "secrete"}}}' -H "Content-type: application/json" http://localhost:35357/v2.0/tokens
+
+Enabling debugging middleware
+-----------------------------
+
+You can enable a huge amount of additional data (debugging information) about
+the request and repsonse objects flowing through Keystone using the debugging
+WSGI middleware.
+
+To enable this, just modify the pipelines in ``etc/keystone.conf``, changing::
+
+    [pipeline:admin]
+    pipeline =
+        urlrewritefilter
+        admin_api
+
+    [pipeline:keystone-legacy-auth]
+    pipeline =
+        urlrewritefilter
+        legacy_auth
+        RAX-KEY-extension
+        service_api
+
+to::
+
+    [pipeline:admin]
+    pipeline =
+        debug
+        urlrewritefilter
+        admin_api
+
+    [pipeline:keystone-legacy-auth]
+    pipeline =
+        debug
+        urlrewritefilter
+        legacy_auth
+        RAX-KEY-extension
+        service_api
diff -Naur keystone/doc/source/gettingstarted.rst keystone-new/doc/source/gettingstarted.rst
--- keystone/doc/source/gettingstarted.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/gettingstarted.rst	1969-12-31 18:00:00.000000000 -0600
@@ -1,67 +0,0 @@
-..
-      Copyright 2011 OpenStack, LLC
-      All Rights Reserved.
-
-      Licensed under the Apache License, Version 2.0 (the "License"); you may
-      not use this file except in compliance with the License. You may obtain
-      a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-      Unless required by applicable law or agreed to in writing, software
-      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
-      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
-      License for the specific language governing permissions and limitations
-      under the License.
-
-Quick Guide to Getting Started with Keystone
-============================================
-
-
-Dependencies
----------------------------------
-First, you will need to install keystone, if you haven't done so already
- 
-.. toctree::
-   :maxdepth: 1
-
-   installing  
-   
-Creating your first global admin
----------------------------------   
-Change driectory to your install path
-
-   
-   
-Creating your first tenant admin
----------------------------------   
-Change directory to your install path. 
-   
-   
-1. Run the following to create the first tennant::
-
-   $>  bin/keystone-manage tenant add "MyTenant"
-
-2. Run the following to create the first tenant admin::
-   
-   $>  bin/keystone-manage user add MyAdmin P@ssw0rd MyTenant
-   
-.. note::
-   
-   Some reserved roles are defined (and can be modified) through the keystone.conf in the /etc folder.
-
-3. Associate your tenant admin with the Admin role::
-
-   $> bin/keystone-manage role grant Admin MyAdmin
-
-   
-   
-
-
-Curl examples
----------------------------------
-.. toctree::
-   :maxdepth: 1
-
-   adminAPI_curl_examples
-   serviceAPI_curl_examples 
diff -Naur keystone/doc/source/groups.rst keystone-new/doc/source/groups.rst
--- keystone/doc/source/groups.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/groups.rst	1969-12-31 18:00:00.000000000 -0600
@@ -1,19 +0,0 @@
-..
-      Copyright 2011 OpenStack, LLC
-      All Rights Reserved.
-
-      Licensed under the Apache License, Version 2.0 (the "License"); you may
-      not use this file except in compliance with the License. You may obtain
-      a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-      Unless required by applicable law or agreed to in writing, software
-      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
-      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
-      License for the specific language governing permissions and limitations
-      under the License.
-
-Groups
-======
-
diff -Naur keystone/doc/source/index.rst keystone-new/doc/source/index.rst
--- keystone/doc/source/index.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/index.rst	2011-11-15 14:11:29.000000000 -0600
@@ -14,45 +14,75 @@
       License for the specific language governing permissions and limitations
       under the License.
 
-Welcome to Keystone's documentation!
-====================================
+=========================
+Keystone for Contributors
+=========================
+
+Keystone is a cloud identity service written in Python, which provides
+authentication, authorization, and an OpenStack service catalog. It
+implements `OpenStack's Identity API`_.
 
-The Keystone project provides services for authenticating and managing 
-user, account, and role information.
+This document describes Keystone for contributors of the project, and assumes
+that you are already familiar with Keystone from an `end-user perspective`_.
 
-Concepts
-========
+.. _`OpenStack's Identity API`: https://github.com/openstack/identity-api
+.. _`end-user perspective`: http://docs.openstack.org/
+
+Getting Started
+===============
 
 .. toctree::
-   :maxdepth: 1
+    :maxdepth: 1
 
-   users
-   tenants
-   groups
-   roles
+    setup
+    testing
+    migration
+    configuration
+    community
+    usingkeystone
 
-Using Keystone
-==============
+API Use Case Examples
+=====================
 
 .. toctree::
-   :maxdepth: 1
+    :maxdepth: 1
 
-   installing  
-   gettingstarted
-   
-Developer Docs
-==============
+    adminAPI_curl_examples
+    serviceAPI_curl_examples
+
+Configuration File Examples
+===========================
 
 .. toctree::
-   :maxdepth: 1
+    :maxdepth: 1
+
+    nova-api-paste
+    keystone.conf
 
-   architecture
-   community
+Man Pages
+=========
 
-Outstanding Documentation Tasks
-===============================
+.. toctree::
+    :maxdepth: 1
+
+    man/keystone-manage
+    man/keystone
+    man/keystone-auth
+    man/keystone-admin
+    man/keystone-import
+    man/keystone-control
+    man/sampledata
+
+Developer Docs
+==============
+
+.. toctree::
+    :maxdepth: 1
 
-.. todolist::
+    developing
+    architecture
+    middleware
+    sourcecode/autoindex
 
 Indices and tables
 ==================
diff -Naur keystone/doc/source/installing.rst keystone-new/doc/source/installing.rst
--- keystone/doc/source/installing.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/installing.rst	1969-12-31 18:00:00.000000000 -0600
@@ -1,136 +0,0 @@
-..
-      Copyright 2011 OpenStack, LLC
-      All Rights Reserved.
-
-      Licensed under the Apache License, Version 2.0 (the "License"); you may
-      not use this file except in compliance with the License. You may obtain
-      a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-      Unless required by applicable law or agreed to in writing, software
-      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
-      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
-      License for the specific language governing permissions and limitations
-      under the License.
-
-Installing Keystone
-===================
-
-Installing from packages
-~~~~~~~~~~~~~~~~~~~~~~~~
-
-To install the latest version of Keystone from the Github repositories,
-following the following instructions.
-
-Debian/Ubuntu
-#############
-
-1. Add the Keystone PPA to your sources.lst::
-
-   $> sudo add-apt-repository ppa:keystone-core/trunk
-   $> sudo apt-get update
-
-2. Install Keystone::
-
-   $> sudo apt-get install keystone
-
-
-RedHat/Fedora
-#############
-
-On some OSes, specifically Fedora 15, the current versions of
-greenlet/eventlet segfault when running keystone. To fix this, install
-the development versions of greenlet and eventlet::
-
-    $ pip uninstall greenlet eventlet
-    $ cd <appropriate working directory>
-    $ hg clone https://bitbucket.org/ambroff/greenlet
-    $ cd greenlet
-    $ sudo python setup.py install
-
-    $ cd <appropriate working directory>
-    $ hg clone https://bitbucket.org/which_linden/eventlet
-    $ cd greenlet
-    $ sudo python setup.py install
-
-Installing from source tarballs
-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-
-To install the latest version of Keystone from the Launchpad Bazaar repositories,
-following the following instructions.
-
-#. Grab the source tarball from `Github <https://github.com/openstack/keystone>`_
-
-#. Untar the source tarball::
-
-   $> tar -xzf <FILE>
-
-#. Install dependencies::
-
-   $> sudo apt-get install -y git python-pip gcc python-lxml libxml2 python-greenlet-dbg python-dev libsqlite3-dev libldap2-dev libssl-dev libxml2-dev libxslt1-dev libsasl2-dev
-
-#. Change into the package directory and build/install::
-
-   $> cd keystone-<RELEASE>
-   $> sudo python setup.py install
-
-Installing from a Github Branch
-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-
-To install the latest version of Keystone from the Github repositories,
-see the following instructions.
-
-Debian/Ubuntu
-#############
-
-.. note::
-   If you want to build the Keystone documentation locally, you will also want
-   to install the python-sphinx package in the first step.
-
-#. Install Git and build dependencies::
-
-   $> sudo apt-get install git python-eventlet python-routes python-greenlet swift
-   $> sudo apt-get install python-argparse python-sqlalchemy python-wsgiref python-pastedeploy
-
-#. Branch Keystone's trunk branch:: (see http://wiki.openstack.org/GerritWorkflow to get the project initially setup)::
-
-   $> git checkout master
-   $> git pull origin master
-
-#. Install Keystone::
-
-   $> sudo python setup.py install
-
-RedHat/Fedora
-#############
-
-.. todo:: Need some help on this one...
-
-Mac OSX
-#######
-
-#. Install git - on your Mac this is most easily done by installing Xcode.
-
-#. Branch Keystone's trunk branch:: (see http://wiki.openstack.org/GerritWorkflow to get the project initially setup)::
-
-   $> git checkout master
-   $> git pull origin master
-
-#. Set up the virtual environment to get the additional dependencies
-
-   $> python tools/install_venv.py
-
-   If you don't want to use a virtual environment, install the dependencies
-   directly using:
-
-   $> sudo pip install -r tools/pip-requires
-
-#. Activate the virtual environment
-
-   $> source .keystone-venv/bin/activate
-
-#. Install keystone:
-
-   $> python setup.py develop
-
diff -Naur keystone/doc/source/keystone.conf.rst keystone-new/doc/source/keystone.conf.rst
--- keystone/doc/source/keystone.conf.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/keystone.conf.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,107 @@
+..
+      Copyright 2011 OpenStack, LLC
+      All Rights Reserved.
+
+      Licensed under the Apache License, Version 2.0 (the "License"); you may
+      not use this file except in compliance with the License. You may obtain
+      a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+      Unless required by applicable law or agreed to in writing, software
+      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+      License for the specific language governing permissions and limitations
+      under the License.
+
+keystone.conf example
+=====================
+::
+
+    [DEFAULT]
+    # Show more verbose log output (sets INFO log level output)
+    verbose = False
+
+    # Show debugging output in logs (sets DEBUG log level output)
+    debug = False
+
+    # Which backend store should Keystone use by default.
+    # Default: 'sqlite'
+    # Available choices are 'sqlite' [future will include LDAP, PAM, etc]
+    default_store = sqlite
+
+    # Log to this file. Make sure you do not set the same log
+    # file for both the API and registry servers!
+    log_file = %DEST%/keystone/keystone.log
+
+    # List of backends to be configured
+    backends = keystone.backends.sqlalchemy
+    #For LDAP support, add: ,keystone.backends.ldap
+
+    # Dictionary Maps every service to a header.Missing services would get header
+    # X_(SERVICE_NAME) Key => Service Name, Value => Header Name
+    service-header-mappings = {
+        'nova' : 'X-Server-Management-Url',
+        'swift' : 'X-Storage-Url',
+        'cdn' : 'X-CDN-Management-Url'}
+
+    # Address to bind the API server
+    # TODO Properties defined within app not available via pipeline.
+    service_host = 0.0.0.0
+
+    # Port the bind the API server to
+    service_port = 5000
+
+    # Address to bind the Admin API server
+    admin_host = 0.0.0.0
+
+    # Port the bind the Admin API server to
+    admin_port = 35357
+
+    #Role that allows to perform admin operations.
+    keystone-admin-role = KeystoneAdmin
+
+    #Role that allows to perform service admin operations.
+    keystone-service-admin-role = KeystoneServiceAdmin
+
+    [keystone.backends.sqlalchemy]
+    # SQLAlchemy connection string for the reference implementation registry
+    # server. Any valid SQLAlchemy connection string is fine.
+    # See: http://bit.ly/ideIpI
+    #sql_connection = sqlite:///keystone.db
+    sql_connection = %SQL_CONN%
+    backend_entities = ['UserRoleAssociation', 'Endpoints', 'Role', 'Tenant',
+                        'User', 'Credentials', 'EndpointTemplates', 'Token',
+                        'Service']
+
+    # Period in seconds after which SQLAlchemy should reestablish its connection
+    # to the database.
+    sql_idle_timeout = 30
+
+    [pipeline:admin]
+    pipeline =
+        urlrewritefilter
+        admin_api
+
+    [pipeline:keystone-legacy-auth]
+    pipeline =
+        urlrewritefilter
+        legacy_auth
+        RAX-KEY-extension
+        service_api
+
+    [app:service_api]
+    paste.app_factory = keystone.server:service_app_factory
+
+    [app:admin_api]
+    paste.app_factory = keystone.server:admin_app_factory
+
+    [filter:urlrewritefilter]
+    paste.filter_factory = keystone.middleware.url:filter_factory
+
+    [filter:legacy_auth]
+    paste.filter_factory = keystone.frontends.legacy_token_auth:filter_factory
+
+    [filter:RAX-KEY-extension]
+    paste.filter_factory = keystone.contrib.extensions.service.raxkey.frontend:filter_factory
+
diff -Naur keystone/doc/source/man/keystone-admin.rst keystone-new/doc/source/man/keystone-admin.rst
--- keystone/doc/source/man/keystone-admin.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/man/keystone-admin.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,86 @@
+==============
+keystone-admin
+==============
+
+---------------------------
+Keystone Management Utility
+---------------------------
+
+:Author: keystone@lists.launchpad.net
+:Date:   2011-10-31
+:Copyright: OpenStack LLC
+:Version: 0.1.2
+:Manual section: 1
+:Manual group: cloud computing
+
+SYNOPSIS
+========
+
+  keystone-admin [options]
+
+DESCRIPTION
+===========
+
+keystone-admin starts the administrative API server for Keystone.
+Use :doc:`keystone-control` to stop/start/restart and manage those services
+once started.
+
+USAGE
+=====
+
+ ``keystone-admin [options]``
+
+Common Options:
+^^^^^^^^^^^^^^^
+
+   --version                     show program's version number and exit
+   -h, --help                    show this help message and exit
+   -v, --verbose                 Print more verbose output
+   -d, --debug                   Print debugging output to console
+   -c PATH, --config-file=PATH   Path to the config file to use. When not
+                                 specified (the default), we generally look at
+                                 the first argument specified to be a config
+                                 file, and if that is also missing, we search
+                                 standard directories for a config file.
+   -p BIND_PORT, --port=BIND_PORT, --bind-port=BIND_PORT
+                                 specifies port to listen on (default is 5000)
+   --host=BIND_HOST, --bind-host=BIND_HOST
+                                 specifies host address to listen on (default
+                                 is all or 0.0.0.0)
+   -t, --trace-calls             Turns on call tracing for troubleshooting
+   -a PORT, --admin-port=PORT    Specifies port for Admin API to listen on
+                                 (default is 35357)
+Logging Options:
+^^^^^^^^^^^^^^^^
+
+The following configuration options are specific to logging
+functionality for this program.
+
+   --log-config=PATH             If this option is specified, the logging
+                                 configuration file specified is used and
+                                 overrides any other logging options specified.
+                                 Please see the Python logging module
+                                 documentation for details on logging
+                                 configuration files.
+   --log-date-format=FORMAT      Format string for %(asctime)s in log records.
+                                 Default: %Y-%m-%d %H:%M:%S
+   --log-file=PATH               (Optional) Name of log file to output to. If
+                                 not set, logging will go to stdout.
+   --log-dir=LOG_DIR             (Optional) The directory to keep log files in
+                                 (will be prepended to --logfile)
+
+FILES
+=====
+
+None
+
+SEE ALSO
+========
+
+* `Keystone <http://github.com/openstack/keystone>`__
+
+SOURCE
+======
+
+* Keystone is sourced in GitHub `Keystone <http://github.com/openstack/keystone>`__
+* Keystone bugs are managed at Launchpad `Launchpad Keystone <https://bugs.launchpad.net/keystone>`__
diff -Naur keystone/doc/source/man/keystone-auth.rst keystone-new/doc/source/man/keystone-auth.rst
--- keystone/doc/source/man/keystone-auth.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/man/keystone-auth.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,87 @@
+=============
+keystone-auth
+=============
+
+---------------------------
+Keystone Management Utility
+---------------------------
+
+:Author: keystone@lists.launchpad.net
+:Date:   2011-10-31
+:Copyright: OpenStack LLC
+:Version: 0.1.2
+:Manual section: 1
+:Manual group: cloud computing
+
+SYNOPSIS
+========
+
+  keystone-auth [options]
+
+DESCRIPTION
+===========
+
+keystone-auth starts the service API server for Keystone.
+Use :doc:`keystone-control` to stop/start/restart and manage those services
+once started.
+
+USAGE
+=====
+
+ ``keystone-auth [options]``
+
+Common Options:
+^^^^^^^^^^^^^^^
+
+   --version                     show program's version number and exit
+   -h, --help                    show this help message and exit
+   -v, --verbose                 Print more verbose output
+   -d, --debug                   Print debugging output to console
+   -c PATH, --config-file=PATH   Path to the config file to use. When not
+                                 specified (the default), we generally look at
+                                 the first argument specified to be a config
+                                 file, and if that is also missing, we search
+                                 standard directories for a config file.
+   -p BIND_PORT, --port=BIND_PORT, --bind-port=BIND_PORT
+                                 specifies port to listen on (default is 5000)
+   --host=BIND_HOST, --bind-host=BIND_HOST
+                                 specifies host address to listen on (default
+                                 is all or 0.0.0.0)
+   -t, --trace-calls             Turns on call tracing for troubleshooting
+   -a PORT, --admin-port=PORT    Specifies port for Admin API to listen on
+                                 (default is 35357)
+
+Logging Options:
+^^^^^^^^^^^^^^^^
+
+The following configuration options are specific to logging
+functionality for this program.
+
+   --log-config=PATH             If this option is specified, the logging
+                                 configuration file specified is used and
+                                 overrides any other logging options specified.
+                                 Please see the Python logging module
+                                 documentation for details on logging
+                                 configuration files.
+   --log-date-format=FORMAT      Format string for %(asctime)s in log records.
+                                 Default: %Y-%m-%d %H:%M:%S
+   --log-file=PATH               (Optional) Name of log file to output to. If
+                                 not set, logging will go to stdout.
+   --log-dir=LOG_DIR             (Optional) The directory to keep log files in
+                                 (will be prepended to --logfile)
+
+FILES
+=====
+
+None
+
+SEE ALSO
+========
+
+* `Keystone <http://github.com/openstack/keystone>`__
+
+SOURCE
+======
+
+* Keystone is sourced in GitHub `Keystone <http://github.com/openstack/keystone>`__
+* Keystone bugs are managed at Launchpad `Launchpad Keystone <https://bugs.launchpad.net/keystone>`__
diff -Naur keystone/doc/source/man/keystone-control.rst keystone-new/doc/source/man/keystone-control.rst
--- keystone/doc/source/man/keystone-control.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/man/keystone-control.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,101 @@
+================
+keystone-control
+================
+
+---------------------------
+Keystone Management Utility
+---------------------------
+
+:Author: keystone@lists.launchpad.net
+:Date:   2011-10-31
+:Copyright: OpenStack LLC
+:Version: 0.1.2
+:Manual section: 1
+:Manual group: cloud computing
+
+SYNOPSIS
+========
+
+  keystone-control [options] <server> <commands> (<conf path>)
+
+DESCRIPTION
+===========
+
+keystone-control is the command line tool that interacts with the keystone
+service to configure Keystone
+
+USAGE
+=====
+
+    ``keystone-control [options] <server> <command> (<conf path>)``
+
+where server is one of:
+
+* all
+* auth
+* admin
+
+and command is one of:
+
+* start
+* stop
+* shutdown
+* restart
+* reload
+* force-reload
+
+Common Options:
+^^^^^^^^^^^^^^^
+
+   --version                     show program's version number and exit
+   -h, --help                    show this help message and exit
+   -v, --verbose                 Print more verbose output
+   -d, --debug                   Print debugging output to console
+   -c PATH, --config-file=PATH   Path to the config file to use. When not
+                                 specified (the default), we generally look at
+                                 the first argument specified to be a config
+                                 file, and if that is also missing, we search
+                                 standard directories for a config file.
+   -p BIND_PORT, --port=BIND_PORT, --bind-port=BIND_PORT
+                                 specifies port to listen on (default is 5000)
+   --host=BIND_HOST, --bind-host=BIND_HOST
+                                 specifies host address to listen on (default
+                                 is all or 0.0.0.0)
+   -t, --trace-calls             Turns on call tracing for troubleshooting
+   -a PORT, --admin-port=PORT    Specifies port for Admin API to listen on
+                                 (default is 35357)
+
+Logging Options:
+^^^^^^^^^^^^^^^^
+
+The following configuration options are specific to logging
+functionality for this program.
+
+   --log-config=PATH             If this option is specified, the logging
+                                 configuration file specified is used and
+                                 overrides any other logging options specified.
+                                 Please see the Python logging module
+                                 documentation for details on logging
+                                 configuration files.
+   --log-date-format=FORMAT      Format string for %(asctime)s in log records.
+                                 Default: %Y-%m-%d %H:%M:%S
+   --log-file=PATH               (Optional) Name of log file to output to. If
+                                 not set, logging will go to stdout.
+   --log-dir=LOG_DIR             (Optional) The directory to keep log files in
+                                 (will be prepended to --logfile)
+
+FILES
+=====
+
+None
+
+SEE ALSO
+========
+
+* `Keystone <http://github.com/openstack/keystone>`__
+
+SOURCE
+======
+
+* Keystone is sourced in GitHub `Keystone <http://github.com/openstack/keystone>`__
+* Keystone bugs are managed at Launchpad `Launchpad Keystone <https://bugs.launchpad.net/keystone>`__
diff -Naur keystone/doc/source/man/keystone-import.rst keystone-new/doc/source/man/keystone-import.rst
--- keystone/doc/source/man/keystone-import.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/man/keystone-import.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,86 @@
+===============
+keystone-import
+===============
+
+---------------------------
+Keystone Management Utility
+---------------------------
+
+:Author: keystone@lists.launchpad.net
+:Date:   2011-10-31
+:Copyright: OpenStack LLC
+:Version: 0.1.2
+:Manual section: 1
+:Manual group: cloud computing
+
+SYNOPSIS
+========
+
+  keystone-import [options] filename
+
+DESCRIPTION
+===========
+
+keystone-import takes a file of commands written in the same format as using
+:doc:`keystone-manage` and imports that data into Keystone. It is intended to
+import users, tenants, and EC2 credentials from nova into keystone.
+
+USAGE
+=====
+
+ ``keystone-import [options] filename``
+
+Common Options:
+^^^^^^^^^^^^^^^
+   --version                     show program's version number and exit
+   -h, --help                    show this help message and exit
+   -v, --verbose                 Print more verbose output
+   -d, --debug                   Print debugging output to console
+   -c PATH, --config-file=PATH   Path to the config file to use. When not
+                                 specified (the default), we generally look at
+                                 the first argument specified to be a config
+                                 file, and if that is also missing, we search
+                                 standard directories for a config file.
+   -p BIND_PORT, --port=BIND_PORT, --bind-port=BIND_PORT
+                                 specifies port to listen on (default is 5000)
+   --host=BIND_HOST, --bind-host=BIND_HOST
+                                 specifies host address to listen on (default
+                                 is all or 0.0.0.0)
+   -t, --trace-calls             Turns on call tracing for troubleshooting
+   -a PORT, --admin-port=PORT    Specifies port for Admin API to listen on
+                                 (default is 35357)
+
+Logging Options:
+^^^^^^^^^^^^^^^^
+
+The following configuration options are specific to logging
+functionality for this program.
+
+   --log-config=PATH             If this option is specified, the logging
+                                 configuration file specified is used and
+                                 overrides any other logging options specified.
+                                 Please see the Python logging module
+                                 documentation for details on logging
+                                 configuration files.
+   --log-date-format=FORMAT      Format string for %(asctime)s in log records.
+                                 Default: %Y-%m-%d %H:%M:%S
+   --log-file=PATH               (Optional) Name of log file to output to. If
+                                 not set, logging will go to stdout.
+   --log-dir=LOG_DIR             (Optional) The directory to keep log files in
+                                 (will be prepended to --logfile)
+
+FILES
+=====
+
+None
+
+SEE ALSO
+========
+
+* `Keystone <http://github.com/openstack/keystone>`__
+
+SOURCE
+======
+
+* Keystone is sourced in GitHub `Keystone <http://github.com/openstack/keystone>`__
+* Keystone bugs are managed at Launchpad `Launchpad Keystone <https://bugs.launchpad.net/keystone>`__
diff -Naur keystone/doc/source/man/keystone-manage.rst keystone-new/doc/source/man/keystone-manage.rst
--- keystone/doc/source/man/keystone-manage.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/man/keystone-manage.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,193 @@
+===============
+keystone-manage
+===============
+
+---------------------------
+Keystone Management Utility
+---------------------------
+
+:Author: keystone@lists.launchpad.net
+:Date:   2010-11-16
+:Copyright: OpenStack LLC
+:Version: 0.1.2
+:Manual section: 1
+:Manual group: cloud computing
+
+SYNOPSIS
+========
+
+  keystone-manage [options]
+
+DESCRIPTION
+===========
+
+keystone-manage is the command line tool that interacts with the keystone
+service to configure Keystone
+
+USAGE
+=====
+
+    ``keystone-manage [options] type action [additional args]``
+
+user
+^^^^
+
+* **user add** [username] [password]
+
+  adds a user to Keystone's data store
+
+* **user list**
+
+  lists all users
+
+* **user disable** [username]
+
+  disables the user *username*
+
+tenant
+^^^^^^
+
+* **tenant add** [tenant_name]
+
+  adds a tenant to Keystone's data store
+
+* **tenant list**
+
+  lists all users
+
+* **tenant disable** [tenant_name]
+
+role
+^^^^
+
+Roles are used to associated users to tenants. Two roles are defined related
+to the Keystone service in it's configuration file :doc:`../keystone.conf`
+
+* **role add** [role_name]
+
+  adds a role
+
+* **role list** ([tenant_name])
+
+  lists all roles, or all roles for tenant, if tenant_name is provided
+
+* **role grant** [role_name] [username] ([tenant])
+
+  grants a role to a specific user. Granted globally if tenant_name is not
+  provided or granted for a specific tenant if tenant_name is provided.
+
+service
+^^^^^^^
+
+* **service add** [name] [type] [description]
+
+  adds a service
+
+* **service list**
+
+  lists all services with id, name, and type
+
+endpointTemplate
+^^^^^^^^^^^^^^^^
+
+* **endpointTemplate add** [region] [service] [public_url] [admin_url] [internal_url] [enabled] [is_global]
+
+  Add a service endpoint for keystone.
+
+  example::
+
+      keystone-manage endpointTemplates add RegionOne \
+                      keystone \
+                      http://keystone_host:5000/v2.0 \
+                      http://keystone_host:35357/v2.0 \
+                      http://keystone_host:5000/v2.0 \
+                      1 1
+
+
+* **endpointTemplate list** ([tenant_name])
+
+  lists endpoint templates with service, region, and public_url. Restricted to
+tenant endpoints if tenant_name is provided.
+
+token
+^^^^^
+
+* **token add** [token] [username] [tenant] [expiration]
+
+  adds a token for a given user and tenant with an expiration
+
+* **token list**
+
+  lists all tokens
+
+* **token delete** [token]
+
+  deletes the identified token
+
+endpoint
+^^^^^^^^
+
+* **endpoint add** [tenant_name] [endpoint_template]
+
+  adds a tenant-specific endpoint
+
+credentials
+^^^^^^^^^^^
+
+* **credentials add** [username] [type] [key] [password] ([tenant_name])
+
+OPTIONS
+=======
+
+   --version                     show program's version number and exit
+   -h, --help                    show this help message and exit
+   -v, --verbose                 Print more verbose output
+   -d, --debug                   Print debugging output to console
+   -c PATH, --config-file=PATH   Path to the config file to use. When not
+                                 specified (the default), we generally look at
+                                 the first argument specified to be a config
+                                 file, and if that is also missing, we search
+                                 standard directories for a config file.
+   -p BIND_PORT, --port=BIND_PORT, --bind-port=BIND_PORT
+                                 specifies port to listen on (default is 5000)
+   --host=BIND_HOST, --bind-host=BIND_HOST
+                                 specifies host address to listen on (default
+                                 is all or 0.0.0.0)
+   -t, --trace-calls             Turns on call tracing for troubleshooting
+   -a PORT, --admin-port=PORT    Specifies port for Admin API to listen on
+                                 (default is 35357)
+
+Logging Options:
+================
+
+The following configuration options are specific to logging
+functionality for this program.
+
+   --log-config=PATH             If this option is specified, the logging
+                                 configuration file specified is used and
+                                 overrides any other logging options specified.
+                                 Please see the Python logging module
+                                 documentation for details on logging
+                                 configuration files.
+   --log-date-format=FORMAT      Format string for %(asctime)s in log records.
+                                 Default: %Y-%m-%d %H:%M:%S
+   --log-file=PATH               (Optional) Name of log file to output to. If
+                                 not set, logging will go to stdout.
+   --log-dir=LOG_DIR             (Optional) The directory to keep log files in
+                                 (will be prepended to --logfile)
+
+FILES
+=====
+
+None
+
+SEE ALSO
+========
+
+* `Keystone <http://github.com/openstack/keystone>`__
+
+SOURCE
+======
+
+* Keystone is sourced in GitHub `Keystone <http://github.com/openstack/keystone>`__
+* Keystone bugs are managed at Launchpad `Launchpad Keystone <https://bugs.launchpad.net/keystone>`__
diff -Naur keystone/doc/source/man/keystonemanage.rst keystone-new/doc/source/man/keystonemanage.rst
--- keystone/doc/source/man/keystonemanage.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/man/keystonemanage.rst	1969-12-31 18:00:00.000000000 -0600
@@ -1,54 +0,0 @@
-===============
-keystone-manage
-===============
-
----------------------------
-Keystone Management Utility
----------------------------
-
-:Author: keystone@lists.launchpad.net
-:Date:   2010-11-16
-:Copyright: OpenStack LLC
-:Version: 0.1.2
-:Manual section: 1
-:Manual group: cloud computing
-
-SYNOPSIS
-========
-
-  keystone-manage [options]
-
-DESCRIPTION
-===========
-
-keystone-manage is a utility for managing and configuring a Keystone installation.
-One important use of keystone-manage is to setup the database. To do this run::
-
-    keystone-manage db_sync
-
-OPTIONS
-=======
-
-  **General options**
-
-  **-v, --verbose**
-        Print more verbose output
-
-  **--sql_connection=CONN_STRING**
-        A proper SQLAlchemy connection string as described
-        `here <http://www.sqlalchemy.org/docs/05/reference/sqlalchemy/connections.html?highlight=engine#sqlalchemy.create_engine>`_
-
-FILES
-=====
-
-None
-
-SEE ALSO
-========
-
-* `Keystone <http://github.com/rackspace/keystone>`__
-
-BUGS
-====
-
-* Keystone is sourced in GitHub so you can view current bugs at `Keystone <http://github.com/rackspace/keystone>`__
diff -Naur keystone/doc/source/man/keystone.rst keystone-new/doc/source/man/keystone.rst
--- keystone/doc/source/man/keystone.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/man/keystone.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,90 @@
+========
+keystone
+========
+
+---------------------------
+Keystone Management Utility
+---------------------------
+
+:Author: keystone@lists.launchpad.net
+:Date:   2010-11-16
+:Copyright: OpenStack LLC
+:Version: 0.1.2
+:Manual section: 1
+:Manual group: cloud computing
+
+SYNOPSIS
+========
+
+  keystone [options]
+
+DESCRIPTION
+===========
+
+keystone starts both the service and administrative API servers for Keystone.
+Use :doc:`keystone-control` to stop/start/restart and manage those services
+once started.
+
+USAGE
+=====
+
+ keystone ``keystone [options]``
+
+Common Options:
+^^^^^^^^^^^^^^^
+   --version             show program's version number and exit
+   -h, --help            show this help message and exit
+
+The following configuration options are common to all keystone
+programs.::
+
+   -v, --verbose                 Print more verbose output
+   -d, --debug                   Print debugging output to console
+   -c PATH, --config-file=PATH   Path to the config file to use. When not
+                                 specified (the default), we generally look at
+                                 the first argument specified to be a config
+                                 file, and if that is also missing, we search
+                                 standard directories for a config file.
+   -p BIND_PORT, --port=BIND_PORT, --bind-port=BIND_PORT
+                                 specifies port to listen on (default is 5000)
+   --host=BIND_HOST, --bind-host=BIND_HOST
+                                 specifies host address to listen on (default
+                                 is all or 0.0.0.0)
+   -t, --trace-calls             Turns on call tracing for troubleshooting
+   -a PORT, --admin-port=PORT    Specifies port for Admin API to listen on
+                                 (default is 35357)
+
+Logging Options:
+^^^^^^^^^^^^^^^^
+
+The following configuration options are specific to logging
+functionality for this program.::
+
+   --log-config=PATH             If this option is specified, the logging
+                                 configuration file specified is used and
+                                 overrides any other logging options specified.
+                                 Please see the Python logging module
+                                 documentation for details on logging
+                                 configuration files.
+   --log-date-format=FORMAT      Format string for %(asctime)s in log records.
+                                 Default: %Y-%m-%d %H:%M:%S
+   --log-file=PATH               (Optional) Name of log file to output to. If
+                                 not set, logging will go to stdout.
+   --log-dir=LOG_DIR             (Optional) The directory to keep log files in
+                                 (will be prepended to --logfile)
+
+FILES
+=====
+
+None
+
+SEE ALSO
+========
+
+* `Keystone <http://github.com/openstack/keystone>`__
+
+SOURCE
+======
+
+* Keystone is sourced in GitHub `Keystone <http://github.com/openstack/keystone>`__
+* Keystone bugs are managed at Launchpad `Launchpad Keystone <https://bugs.launchpad.net/keystone>`__
diff -Naur keystone/doc/source/man/sampledata.rst keystone-new/doc/source/man/sampledata.rst
--- keystone/doc/source/man/sampledata.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/man/sampledata.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,85 @@
+==========
+sampledata
+==========
+
+---------------------------
+Keystone Management Utility
+---------------------------
+
+:Author: keystone@lists.launchpad.net
+:Date:   2011-10-31
+:Copyright: OpenStack LLC
+:Version: 0.1.2
+:Manual section: 1
+:Manual group: cloud computing
+
+SYNOPSIS
+========
+
+  sampledata [options]
+
+DESCRIPTION
+===========
+
+sampledata creates a development set of sample data for use with testing
+keystone.
+
+USAGE
+=====
+
+ ``sampledata [options]``
+
+Common Options:
+^^^^^^^^^^^^^^^
+   --version                     show program's version number and exit
+   -h, --help                    show this help message and exit
+   -v, --verbose                 Print more verbose output
+   -d, --debug                   Print debugging output to console
+   -c PATH, --config-file=PATH   Path to the config file to use. When not
+                                 specified (the default), we generally look at
+                                 the first argument specified to be a config
+                                 file, and if that is also missing, we search
+                                 standard directories for a config file.
+   -p BIND_PORT, --port=BIND_PORT, --bind-port=BIND_PORT
+                                 specifies port to listen on (default is 5000)
+   --host=BIND_HOST, --bind-host=BIND_HOST
+                                 specifies host address to listen on (default
+                                 is all or 0.0.0.0)
+   -t, --trace-calls             Turns on call tracing for troubleshooting
+   -a PORT, --admin-port=PORT    Specifies port for Admin API to listen on
+                                 (default is 35357)
+
+Logging Options:
+^^^^^^^^^^^^^^^^
+
+The following configuration options are specific to logging
+functionality for this program.
+
+   --log-config=PATH             If this option is specified, the logging
+                                 configuration file specified is used and
+                                 overrides any other logging options specified.
+                                 Please see the Python logging module
+                                 documentation for details on logging
+                                 configuration files.
+   --log-date-format=FORMAT      Format string for %(asctime)s in log records.
+                                 Default: %Y-%m-%d %H:%M:%S
+   --log-file=PATH               (Optional) Name of log file to output to. If
+                                 not set, logging will go to stdout.
+   --log-dir=LOG_DIR             (Optional) The directory to keep log files in
+                                 (will be prepended to --logfile)
+
+FILES
+=====
+
+None
+
+SEE ALSO
+========
+
+* `Keystone <http://github.com/openstack/keystone>`__
+
+SOURCE
+======
+
+* Keystone is sourced in GitHub `Keystone <http://github.com/openstack/keystone>`__
+* Keystone bugs are managed at Launchpad `Launchpad Keystone <https://bugs.launchpad.net/keystone>`__
diff -Naur keystone/doc/source/middleware.rst keystone-new/doc/source/middleware.rst
--- keystone/doc/source/middleware.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/middleware.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,65 @@
+..
+      Copyright 2011 OpenStack, LLC
+      All Rights Reserved.
+
+      Licensed under the Apache License, Version 2.0 (the "License"); you may
+      not use this file except in compliance with the License. You may obtain
+      a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+      Unless required by applicable law or agreed to in writing, software
+      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+      License for the specific language governing permissions and limitations
+      under the License.
+
+==========
+Middleware
+==========
+
+The Keystone middleware sits in front of an OpenStack service and handles authenticating
+incoming requests. The middleware was designed according to `this spec`.
+
+The middleware is found in source under Keystone/middleware.
+
+The middleware supports two interfaces; WSGI and REST/HTTP.
+
+.. _`this spec`: http://wiki.openstack.org/openstack-authn
+
+REST & HTTP API
+===============
+
+If an unauthenticated call comes in, the middleware will respond with a 401 Unauthorized error. As per
+HTTP standards, it will also return a WWW-Authenticate header informing the caller
+of what protocols are supported. For Keystone authentication, the response syntax will be::
+
+    WWW-Authenticate: Keystone uri="url to Keystone server"
+
+The client can then make the necessary calls to the Keystone server, obtain a token, and retry the call with the token.
+
+The token is passed in using ther X-Auth-Token header.
+
+WSGI API (Headers)
+==================
+
+Upon successful authentication the middleware sends the following
+headers to the downstream WSGI app:
+
+X-Identity-Status
+    Provides information on whether the request was authenticated or not.
+
+X-Tenant
+    Provides the tenant ID (as it appears in the URL in Keystone). This is to support any legacy implementations before Keystone switched to an ID/Name schema for tenants.
+
+X-Tenant-Id
+    The unique, immutable tenant Id
+
+X-Tenant-Name
+    The unique, but mutable (it can change) tenant name.
+
+X-User
+    The username used to log in
+
+X-Roles
+    The roles associated with that user
diff -Naur keystone/doc/source/migration.rst keystone-new/doc/source/migration.rst
--- keystone/doc/source/migration.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/migration.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,35 @@
+================
+Using Migrations
+================
+
+Keystone uses sqlalchemy-migrate to manage migrations.
+
+
+Running Migrations
+======================
+
+Keep backups of your db.Add your existing database to version control.
+
+Example::
+
+$python keystone/backends/sqlalchemy/migrate_repo/manage.py version_control  --url=sqlite:///bin/keystone.db --repository=keystone/backends/sqlalchemy/migrate_repo/
+
+
+Set your current db version to appropriate version_number.
+
+Version number 1 maps to diablo release.
+
+Example::
+ 
+UPDATE migrate_version SET version=1; 
+
+Perform Upgrades/Downgrades
+
+Example Upgrade ::
+
+$python keystone/backends/sqlalchemy/migrate_repo/manage.py upgrade  --url=sqlite:///bin/keystone.db --repository=keystone/backends/sqlalchemy/migrate_repo/
+
+Example Downgrade::
+
+$python keystone/backends/sqlalchemy/migrate_repo/manage.py downgrade 1   --url=sqlite:///bin/keystone.db --repository=keystone/backends/sqlalchemy/migrate_repo/
+
diff -Naur keystone/doc/source/nova-api-paste.rst keystone-new/doc/source/nova-api-paste.rst
--- keystone/doc/source/nova-api-paste.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/nova-api-paste.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,148 @@
+..
+      Copyright 2011 OpenStack, LLC
+      All Rights Reserved.
+
+      Licensed under the Apache License, Version 2.0 (the "License"); you may
+      not use this file except in compliance with the License. You may obtain
+      a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+      Unless required by applicable law or agreed to in writing, software
+      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+      License for the specific language governing permissions and limitations
+      under the License.
+
+nova-api-paste example
+======================
+::
+
+    #######
+    # EC2 #
+    #######
+
+    [composite:ec2]
+    use = egg:Paste#urlmap
+    /: ec2versions
+    /services/Cloud: ec2cloud
+    /services/Admin: ec2admin
+    /latest: ec2metadata
+    /2007-01-19: ec2metadata
+    /2007-03-01: ec2metadata
+    /2007-08-29: ec2metadata
+    /2007-10-10: ec2metadata
+    /2007-12-15: ec2metadata
+    /2008-02-01: ec2metadata
+    /2008-09-01: ec2metadata
+    /2009-04-04: ec2metadata
+    /1.0: ec2metadata
+
+    [pipeline:ec2cloud]
+    pipeline = logrequest totoken authtoken keystonecontext cloudrequest authorizer ec2executor
+
+    [pipeline:ec2admin]
+    pipeline = logrequest totoken authtoken keystonecontext adminrequest authorizer ec2executor
+
+    [pipeline:ec2metadata]
+    pipeline = logrequest ec2md
+
+    [pipeline:ec2versions]
+    pipeline = logrequest ec2ver
+
+    [filter:logrequest]
+    paste.filter_factory = nova.api.ec2:RequestLogging.factory
+
+    [filter:ec2lockout]
+    paste.filter_factory = nova.api.ec2:Lockout.factory
+
+    [filter:totoken]
+    paste.filter_factory = keystone.middleware.ec2_token:EC2Token.factory
+
+    [filter:ec2noauth]
+    paste.filter_factory = nova.api.ec2:NoAuth.factory
+
+    [filter:authenticate]
+    paste.filter_factory = nova.api.ec2:Authenticate.factory
+
+    [filter:cloudrequest]
+    controller = nova.api.ec2.cloud.CloudController
+    paste.filter_factory = nova.api.ec2:Requestify.factory
+
+    [filter:adminrequest]
+    controller = nova.api.ec2.admin.AdminController
+    paste.filter_factory = nova.api.ec2:Requestify.factory
+
+    [filter:authorizer]
+    paste.filter_factory = nova.api.ec2:Authorizer.factory
+
+    [app:ec2executor]
+    paste.app_factory = nova.api.ec2:Executor.factory
+
+    [app:ec2ver]
+    paste.app_factory = nova.api.ec2:Versions.factory
+
+    [app:ec2md]
+    paste.app_factory = nova.api.ec2.metadatarequesthandler:MetadataRequestHandler.factory
+
+    #############
+    # Openstack #
+    #############
+
+    [composite:osapi]
+    use = egg:Paste#urlmap
+    /: osversions
+    /v1.0: openstackapi10
+    /v1.1: openstackapi11
+
+    [pipeline:openstackapi10]
+    pipeline = faultwrap authtoken keystonecontext ratelimit osapiapp10
+
+    [pipeline:openstackapi11]
+    pipeline = faultwrap authtoken keystonecontext ratelimit extensions osapiapp11
+
+    [filter:faultwrap]
+    paste.filter_factory = nova.api.openstack:FaultWrapper.factory
+
+    [filter:auth]
+    paste.filter_factory = nova.api.openstack.auth:AuthMiddleware.factory
+
+    [filter:noauth]
+    paste.filter_factory = nova.api.openstack.auth:NoAuthMiddleware.factory
+
+    [filter:ratelimit]
+    paste.filter_factory = nova.api.openstack.limits:RateLimitingMiddleware.factory
+
+    [filter:extensions]
+    paste.filter_factory = nova.api.openstack.extensions:ExtensionMiddleware.factory
+
+    [app:osapiapp10]
+    paste.app_factory = nova.api.openstack:APIRouterV10.factory
+
+    [app:osapiapp11]
+    paste.app_factory = nova.api.openstack:APIRouterV11.factory
+
+    [pipeline:osversions]
+    pipeline = faultwrap osversionapp
+
+    [app:osversionapp]
+    paste.app_factory = nova.api.openstack.versions:Versions.factory
+
+    ##########
+    # Shared #
+    ##########
+
+    [filter:keystonecontext]
+    paste.filter_factory = keystone.middleware.nova_keystone_context:NovaKeystoneContext.factory
+
+    [filter:authtoken]
+    paste.filter_factory = keystone.middleware.auth_token:filter_factory
+    service_protocol = http
+    service_host = 127.0.0.1
+    service_port = 5000
+    auth_host = 127.0.0.1
+    auth_port = 35357
+    auth_protocol = http
+    auth_uri = http://127.0.0.1:5000/
+    admin_token = 999888777666
+
diff -Naur keystone/doc/source/roles.rst keystone-new/doc/source/roles.rst
--- keystone/doc/source/roles.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/roles.rst	1969-12-31 18:00:00.000000000 -0600
@@ -1,19 +0,0 @@
-..
-      Copyright 2011 OpenStack, LLC
-      All Rights Reserved.
-
-      Licensed under the Apache License, Version 2.0 (the "License"); you may
-      not use this file except in compliance with the License. You may obtain
-      a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-      Unless required by applicable law or agreed to in writing, software
-      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
-      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
-      License for the specific language governing permissions and limitations
-      under the License.
-
-Roles
-=====
-
diff -Naur keystone/doc/source/serviceAPI_curl_examples.rst keystone-new/doc/source/serviceAPI_curl_examples.rst
--- keystone/doc/source/serviceAPI_curl_examples.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/serviceAPI_curl_examples.rst	2011-11-15 14:12:31.000000000 -0600
@@ -14,19 +14,58 @@
       License for the specific language governing permissions and limitations
       under the License.
 
-Curl Service API examples
+===============================
+Service API Examples Using Curl
+===============================
+
+The service API is defined to be a subset of the Admin API and, by
+default, runs on port 5000.
+
+GET /
 =====
 
-All examples assume default port usage (5000)
+This call is identical to that documented for the Admin API, except
+that it uses port 5000, instead of port 35357, by default::
 
-Initial GET 
-#############
-Retrieves version, full API url, pdf doc link, and wadl link::
+    $ curl http://0.0.0.0:5000
 
-	$> curl http://0.0.0.0:5000
 or::
 
-	$> curl http://0.0.0.0:5000/v2.0/
+    $ curl http://0.0.0.0:5000/v2.0/
+
+See the `Admin API Examples Using Curl`_ for more info.
+
+.. _`Admin API Examples Using Curl`: adminAPI_curl_examples.html
+
+GET /extensions
+===============
+
+This call is identical to that documented for the Admin API.
+
+POST /tokens
+============
+
+This call is identical to that documented for the Admin API.
+
+GET /tenants
+============
+
+List all of the tenants your token can access::
 
+    $ curl -H "X-Auth-Token:887665443383838" http://localhost:5000/v2.0/tenants
 
+Returns::
 
+    {
+        "tenants":{
+            "values":[
+                {
+                    "enabled":true,
+                    "description":"None",
+                    "name":"customer-x",
+                    "id":"1"
+                }
+            ],
+            "links":[]
+        }
+    }
diff -Naur keystone/doc/source/setup.rst keystone-new/doc/source/setup.rst
--- keystone/doc/source/setup.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/setup.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,132 @@
+..
+      Copyright 2011 OpenStack, LLC
+      All Rights Reserved.
+
+      Licensed under the Apache License, Version 2.0 (the "License"); you may
+      not use this file except in compliance with the License. You may obtain
+      a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+      Unless required by applicable law or agreed to in writing, software
+      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+      License for the specific language governing permissions and limitations
+      under the License.
+
+===============================================
+Setting up a Keystone a development environment
+===============================================
+
+This document describes setting up keystone directly from GitHub_
+for development purposes.
+
+To install keystone from packaging, refer instead to Keystone's `User Documentation`_.
+
+.. _GitHub: http://github.com/openstack/keystone
+.. _`User Documentation`: http://docs.openstack.org/
+
+Prerequisites
+=============
+
+This document assumes you are using:
+
+- Ubuntu 11.10, Fedora 15, or Mac OS X Lion
+- `Python 2.7`_
+
+.. _`Python 2.7`: http://www.python.org/
+
+And that you have the following tools available on your system:
+
+- git_
+- setuptools_
+- pip_
+
+**Reminder**: If you're successfully using a different platform, or a
+different version of the above, please document your configuration here!
+
+.. _git: http://git-scm.com/
+.. _setuptools: http://pypi.python.org/pypi/setuptools
+
+Installing dependencies
+=======================
+
+Keystone maintains a list of PyPi_ dependencies, designed for use by
+pip_.
+
+.. _PyPi: http://pypi.python.org/
+.. _pip: http://pypi.python.org/pypi/pip
+
+However, your system *may* need additional dependencies that `pip` (and by
+extension, PyPi) cannot satisfy. These dependencies should be installed
+prior to using `pip`, and the installation method may vary depending on
+your platform.
+
+Ubuntu 11.10::
+
+    $ sudo apt-get install python-dev libxml2-dev libxslt1-dev libsasl2-dev libsqlite3-dev libssl-dev libldap2-dev
+
+Fedora 15::
+
+    $ sudo yum install python-sqlite2 python-lxml python-greenlet-devel python-ldap
+
+Mac OS X Lion (requires MacPorts_)::
+
+    $ sudo port install py-ldap
+
+.. _MacPorts: http://www.macports.org/
+
+PyPi Packages
+-------------
+
+Assuming you have any necessary binary packages & header files available
+on your system, you can then install PyPi dependencies.
+
+You may also need to prefix `pip install` with `sudo`, depending on your
+environment::
+
+    # Describe dependencies (including non-PyPi dependencies)
+    $ cat tools/pip-requires
+
+    # Install all PyPi dependencies (for production, testing, and development)
+    $ pip install -r tools/pip-requires
+
+Updating your PYTHONPATH
+========================
+
+There are a number of methods for getting Keystone into your PYTHON PATH,
+the easiest of which is::
+
+    # Fake-install the project by symlinking Keystone into your Python site-packages
+    $ python setup.py develop
+
+You should then be able to `import keystone` from your Python shell
+without issue::
+
+    >>> import keystone
+    >>>
+
+If you can import keystone successfully, you should be ready to move on to :doc:`testing`.
+
+Troubleshooting
+===============
+
+Eventlet segfaults on RedHat / Fedora
+-------------------------------------
+
+[*If this is no longer an issue, please remove this section, thanks!*]
+
+On some OSes, specifically Fedora 15, the current versions of
+greenlet/eventlet segfault when running keystone. To fix this, install
+the development versions of greenlet and eventlet::
+
+    $ pip uninstall greenlet eventlet
+    $ cd <appropriate working directory>
+    $ hg clone https://bitbucket.org/ambroff/greenlet
+    $ cd greenlet
+    $ sudo python setup.py install
+
+    $ cd <appropriate working directory>
+    $ hg clone https://bitbucket.org/which_linden/eventlet
+    $ cd greenlet
+    $ sudo python setup.py install
diff -Naur keystone/doc/source/tenants.rst keystone-new/doc/source/tenants.rst
--- keystone/doc/source/tenants.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/tenants.rst	1969-12-31 18:00:00.000000000 -0600
@@ -1,19 +0,0 @@
-..
-      Copyright 2011 OpenStack, LLC
-      All Rights Reserved.
-
-      Licensed under the Apache License, Version 2.0 (the "License"); you may
-      not use this file except in compliance with the License. You may obtain
-      a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-      Unless required by applicable law or agreed to in writing, software
-      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
-      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
-      License for the specific language governing permissions and limitations
-      under the License.
-
-Tenants
-=======
-
diff -Naur keystone/doc/source/testing.rst keystone-new/doc/source/testing.rst
--- keystone/doc/source/testing.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/testing.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,89 @@
+================
+Testing Keystone
+================
+
+Keystone uses a number of testing methodologies to ensure correctness.
+
+Running Built-In Tests
+======================
+
+To run the full suites of tests maintained within Keystone, run::
+
+    $ ./run_tests.sh --with-progress
+
+This shows realtime feedback during test execution, and iterates over
+multiple configuration variations.
+
+This differs from how tests are executed from the continuous integration
+environment. Specifically, Jenkins doesn't care about realtime progress,
+and aborts after the first test failure (a fail-fast behavior)::
+
+    $ ./run_tests.sh
+
+Schema Migration Tests
+======================
+
+Schema migrations are tested using SQLAlchemy Migrate's built-in test
+runner::
+
+The test does not start testing from the very top.In order for the test to run, the database 
+that is used to test, should be up to version above the version brought forward by the latest script.::
+
+This command would create the test db with a version of 0.::
+
+$python keystone/backends/sqlalchemy/migrate_repo/manage.py version_control sqlite:///test.db   --repository=keystone/backends/sqlalchemy/migrate_repo/
+
+Use this command to move to the version that is before our latest script.
+
+ie if our latest script has version 3, we should move to 2.::
+
+$python keystone/backends/sqlalchemy/migrate_repo/manage.py upgrade version_number --url=sqlite:///test.db   --repository=keystone/backends/sqlalchemy/migrate_repo/
+
+Now try::
+
+$python keystone/backends/sqlalchemy/migrate_repo/manage.py test  --url=sqlite:///test.db --repository=keystone/backends/sqlalchemy/migrate_repo/
+
+This tests both forward and backward migrations, and should leave behind
+an test sqlite database (``test.db``) that can be safely
+removed or simply ignored.
+
+Writing Tests
+=============
+
+Tests are maintained in the ``keystone.test`` module. Unit tests are
+isolated from functional tests.
+
+Functional Tests
+----------------
+
+The ``keystone.test.functional.common`` module provides a ``unittest``-based
+``httplib`` client which you can extend and use for your own tests.
+Generally, functional tests should serve to illustrate intended use cases
+and API behaviors. To help make your tests easier to read, the test client:
+
+- Authenticates with a known user name and password combination
+- Asserts 2xx HTTP status codes (unless told otherwise)
+- Abstracts keystone REST verbs & resources into single function calls
+
+Testing Multiple Configurations
+-------------------------------
+
+Several variations of the default configuration are iterated over to
+ensure test coverage of mutually exclusive featuresets, such as the
+various backend options.
+
+These configuration templates are maintained in ``keystone/test/etc`` and
+are iterated over by ``run_tests.py``.
+
+Further Testing
+===============
+
+devstack_ is the *best* way to quickly deploy keystone with the rest of the
+OpenStack universe and should be critical step in your development workflow!
+
+You may also be interested in either the `OpenStack Continuous Integration Project`_
+or the `OpenStack Integration Testing Project`_.
+
+.. _devstack: http://devstack.org/
+.. _OpenStack Continuous Integration Project: https://github.com/openstack/openstack-ci
+.. _OpenStack Integration Testing Project: https://github.com/openstack/openstack-integration-tests
diff -Naur keystone/doc/source/users.rst keystone-new/doc/source/users.rst
--- keystone/doc/source/users.rst	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/doc/source/users.rst	1969-12-31 18:00:00.000000000 -0600
@@ -1,19 +0,0 @@
-..
-      Copyright 2011 OpenStack, LLC
-      All Rights Reserved.
-
-      Licensed under the Apache License, Version 2.0 (the "License"); you may
-      not use this file except in compliance with the License. You may obtain
-      a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-      Unless required by applicable law or agreed to in writing, software
-      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
-      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
-      License for the specific language governing permissions and limitations
-      under the License.
-
-Users
-=====
-
diff -Naur keystone/doc/source/usingkeystone.rst keystone-new/doc/source/usingkeystone.rst
--- keystone/doc/source/usingkeystone.rst	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/doc/source/usingkeystone.rst	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,28 @@
+..
+      Copyright 2011 OpenStack, LLC
+      All Rights Reserved.
+
+      Licensed under the Apache License, Version 2.0 (the "License"); you may
+      not use this file except in compliance with the License. You may obtain
+      a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+      Unless required by applicable law or agreed to in writing, software
+      distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+      WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+      License for the specific language governing permissions and limitations
+      under the License.
+
+==============
+Using Keystone
+==============
+
+Curl examples
+-------------
+
+.. toctree::
+   :maxdepth: 1
+
+   adminAPI_curl_examples
+   serviceAPI_curl_examples
diff -Naur keystone/etc/keystone.conf keystone-new/etc/keystone.conf
--- keystone/etc/keystone.conf	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/etc/keystone.conf	2011-11-15 14:12:31.000000000 -0600
@@ -62,12 +62,12 @@
 
 [pipeline:admin]
 pipeline =
-	urlrewritefilter
-	admin_api
+    urlrewritefilter
+    admin_api
 
 [pipeline:keystone-legacy-auth]
 pipeline =
-	urlrewritefilter
+    urlrewritefilter
     legacy_auth
     RAX-KEY-extension
     service_api
@@ -86,3 +86,6 @@
 
 [filter:RAX-KEY-extension]
 paste.filter_factory = keystone.contrib.extensions.service.raxkey.frontend:filter_factory
+
+[filter:debug]
+paste.filter_factory = keystone.common.wsgi:debug_filter_factory
diff -Naur keystone/examples/echo/echo_client.py keystone-new/examples/echo/echo_client.py
--- keystone/examples/echo/echo_client.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/examples/echo/echo_client.py	2011-11-15 14:12:31.000000000 -0600
@@ -23,7 +23,8 @@
 
 
 def get_auth_token(username, password, tenant):
-    headers = {"Content-type": "application/json", "Accept": "text/json"}
+    headers = {"Content-type": "application/json",
+               "Accept": "application/json"}
     params = {"passwordCredentials": {"username": username,
                                       "password": password,
                                       "tenantId": tenant}}
@@ -39,7 +40,7 @@
 def call_service(token):
     headers = {"X-Auth-Token": token,
                "Content-type": "application/json",
-               "Accept": "text/json"}
+               "Accept": "application/json"}
     params = '{"ping": "abcdefg"}'
     conn = httplib.HTTPConnection("localhost:8090")
     conn.request("POST", "/", params, headers=headers)
@@ -53,7 +54,7 @@
     # Injecting headers in the request
     headers = {"X-Auth-Token": token,
                "Content-type": "application/json",
-               "Accept": "text/json\nX_AUTHORIZATION: someone else\n"
+               "Accept": "application/json\nX_AUTHORIZATION: someone else\n"
                "X_IDENTITY_STATUS: Confirmed\nINJECTED_HEADER: aha!"}
     params = '{"ping": "abcdefg"}'
     conn = httplib.HTTPConnection("localhost:8090")
diff -Naur keystone/keystone/backends/ldap/fakeldap.py keystone-new/keystone/backends/ldap/fakeldap.py
--- keystone/keystone/backends/ldap/fakeldap.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/backends/ldap/fakeldap.py	2011-11-15 14:11:29.000000000 -0600
@@ -206,11 +206,9 @@
     def modify_s(self, dn, attrs):
         """Modify the object at dn using the attribute list.
 
-        Args:
-        dn -- a dn
-        attrs -- a list of tuples in the following form:
-            ([MOD_ADD | MOD_DELETE | MOD_REPACE], attribute, value)
-
+        :param dn: an LDAP DN
+        :param attrs: a list of tuples in the following form:
+                      ([MOD_ADD | MOD_DELETE | MOD_REPACE], attribute, value)
         """
         if server_fail:
             raise ldap.SERVER_DOWN
diff -Naur keystone/keystone/backends/sqlalchemy/migrate_repo/manage.py keystone-new/keystone/backends/sqlalchemy/migrate_repo/manage.py
--- keystone/keystone/backends/sqlalchemy/migrate_repo/manage.py	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/keystone/backends/sqlalchemy/migrate_repo/manage.py	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,3 @@
+#!/usr/bin/env python
+from migrate.versioning.shell import main
+main(debug='False')
diff -Naur keystone/keystone/backends/sqlalchemy/migrate_repo/migrate.cfg keystone-new/keystone/backends/sqlalchemy/migrate_repo/migrate.cfg
--- keystone/keystone/backends/sqlalchemy/migrate_repo/migrate.cfg	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/keystone/backends/sqlalchemy/migrate_repo/migrate.cfg	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,20 @@
+[db_settings]
+# Used to identify which repository this database is versioned under.
+# You can use the name of your project.
+repository_id=Keystone
+
+# The name of the database table used to track the schema version.
+# This name shouldn't already be used by your project.
+# If this is changed once a database is under version control, you'll need to 
+# change the table name in each database too. 
+version_table=migrate_version
+
+# When committing a change script, Migrate will attempt to generate the 
+# sql for all supported databases; normally, if one of them fails - probably
+# because you don't have that database installed - it is ignored and the 
+# commit continues, perhaps ending successfully. 
+# Databases in this list MUST compile successfully during a commit, or the 
+# entire commit will fail. List the databases your application will actually 
+# be using to ensure your updates to that database work properly.
+# This must be a list; example: ['postgres','sqlite']
+required_dbs=[]
diff -Naur keystone/keystone/backends/sqlalchemy/migrate_repo/README keystone-new/keystone/backends/sqlalchemy/migrate_repo/README
--- keystone/keystone/backends/sqlalchemy/migrate_repo/README	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/keystone/backends/sqlalchemy/migrate_repo/README	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,4 @@
+This is a database migration repository.
+
+More information at
+http://code.google.com/p/sqlalchemy-migrate/
diff -Naur keystone/keystone/backends/sqlalchemy/migrate_repo/versions/001_initial_migration.py keystone-new/keystone/backends/sqlalchemy/migrate_repo/versions/001_initial_migration.py
--- keystone/keystone/backends/sqlalchemy/migrate_repo/versions/001_initial_migration.py	1969-12-31 18:00:00.000000000 -0600
+++ keystone-new/keystone/backends/sqlalchemy/migrate_repo/versions/001_initial_migration.py	2011-11-15 14:11:29.000000000 -0600
@@ -0,0 +1,196 @@
+# pylint: disable=C0103
+
+
+import sqlalchemy
+
+
+meta = sqlalchemy.MetaData()
+
+
+# services
+
+service = {}
+service['id'] = sqlalchemy.Column('id', sqlalchemy.Integer,
+        primary_key=True, autoincrement=True)
+service['name'] = sqlalchemy.Column('name', sqlalchemy.String(255),
+        unique=True)
+service['type'] = sqlalchemy.Column('type', sqlalchemy.String(255))
+service['desc'] = sqlalchemy.Column('desc', sqlalchemy.String(255))
+services = sqlalchemy.Table('services', meta, *service.values())
+
+sqlalchemy.UniqueConstraint(service['name'])
+
+
+# roles
+
+role = {}
+role['id'] = sqlalchemy.Column('id', sqlalchemy.Integer,
+        primary_key=True, autoincrement=True)
+role['name'] = sqlalchemy.Column('name', sqlalchemy.String(255))
+role['desc'] = sqlalchemy.Column('desc', sqlalchemy.String(255))
+role['service_id'] = sqlalchemy.Column('service_id', sqlalchemy.Integer)
+roles = sqlalchemy.Table('roles', meta, *role.values())
+
+sqlalchemy.UniqueConstraint(role['name'], role['service_id'])
+
+sqlalchemy.ForeignKeyConstraint(
+        [role['service_id']],
+        [service['id']])
+
+
+# tenants
+
+tenant = {}
+tenant['id'] = sqlalchemy.Column('id', sqlalchemy.Integer, primary_key=True,
+        autoincrement=True)
+tenant['name'] = sqlalchemy.Column('name', sqlalchemy.String(255), unique=True)
+tenant['desc'] = sqlalchemy.Column('desc', sqlalchemy.String(255))
+tenant['enabled'] = sqlalchemy.Column('enabled', sqlalchemy.Integer)
+tenants = sqlalchemy.Table('tenants', meta, *tenant.values())
+
+sqlalchemy.UniqueConstraint(tenant['name'])
+
+
+# users
+
+user = {}
+user['id'] = sqlalchemy.Column('id', sqlalchemy.Integer, primary_key=True,
+        autoincrement=True)
+user['name'] = sqlalchemy.Column('name', sqlalchemy.String(255), unique=True)
+user['password'] = sqlalchemy.Column('password', sqlalchemy.String(255))
+user['email'] = sqlalchemy.Column('email', sqlalchemy.String(255))
+user['enabled'] = sqlalchemy.Column('enabled', sqlalchemy.Integer)
+user['tenant_id'] = sqlalchemy.Column('tenant_id', sqlalchemy.Integer)
+users = sqlalchemy.Table('users', meta, *user.values())
+
+sqlalchemy.UniqueConstraint(user['name'])
+
+sqlalchemy.ForeignKeyConstraint(
+        [user['tenant_id']],
+        [tenant['id']])
+
+
+# credentials
+
+credential = {}
+credential['id'] = sqlalchemy.Column('id', sqlalchemy.Integer,
+        primary_key=True, autoincrement=True)
+credential['user_id'] = sqlalchemy.Column('user_id', sqlalchemy.Integer)
+credential['tenant_id'] = sqlalchemy.Column('tenant_id', sqlalchemy.Integer,
+        nullable=True)
+credential['type'] = sqlalchemy.Column('type', sqlalchemy.String(20))
+credential['key'] = sqlalchemy.Column('key', sqlalchemy.String(255))
+credential['secret'] = sqlalchemy.Column('secret', sqlalchemy.String(255))
+credentials = sqlalchemy.Table('credentials', meta, *credential.values())
+
+sqlalchemy.ForeignKeyConstraint(
+        [credential['user_id']],
+        [user['id']])
+sqlalchemy.ForeignKeyConstraint(
+        [credential['tenant_id']],
+        [tenant['id']])
+
+
+# tokens
+
+token = {}
+token['id'] = sqlalchemy.Column('id', sqlalchemy.String(255), primary_key=True,
+        unique=True)
+token['user_id'] = sqlalchemy.Column('user_id', sqlalchemy.Integer)
+token['tenant_id'] = sqlalchemy.Column('tenant_id', sqlalchemy.Integer)
+token['expires'] = sqlalchemy.Column('expires', sqlalchemy.DateTime)
+tokens = sqlalchemy.Table('token', meta, *token.values())
+
+
+# endpoint_templates
+
+endpoint_template = {}
+endpoint_template['id'] = sqlalchemy.Column('id', sqlalchemy.Integer,
+        primary_key=True)
+endpoint_template['region'] = sqlalchemy.Column('region',
+        sqlalchemy.String(255))
+endpoint_template['service_id'] = sqlalchemy.Column('service_id',
+        sqlalchemy.Integer)
+endpoint_template['public_url'] = sqlalchemy.Column('public_url',
+        sqlalchemy.String(2000))
+endpoint_template['admin_url'] = sqlalchemy.Column('admin_url',
+        sqlalchemy.String(2000))
+endpoint_template['internal_url'] = sqlalchemy.Column('internal_url',
+        sqlalchemy.String(2000))
+endpoint_template['enabled'] = sqlalchemy.Column('enabled',
+        sqlalchemy.Boolean)
+endpoint_template['is_global'] = sqlalchemy.Column('is_global',
+        sqlalchemy.Boolean)
+endpoint_templates = sqlalchemy.Table('endpoint_templates', meta,
+        *endpoint_template.values())
+
+sqlalchemy.ForeignKeyConstraint(
+        [endpoint_template['service_id']], [service['id']])
+
+
+# endpoints
+
+endpoint = {}
+endpoint['id'] = sqlalchemy.Column('id', sqlalchemy.Integer, primary_key=True)
+endpoint['tenant_id'] = sqlalchemy.Column('tenant_id', sqlalchemy.Integer)
+endpoint['endpoint_template_id'] = sqlalchemy.Column('endpoint_template_id',
+        sqlalchemy.Integer)
+endpoints = sqlalchemy.Table('endpoints', meta, *endpoint.values())
+
+sqlalchemy.UniqueConstraint(
+        endpoint['endpoint_template_id'], endpoint['tenant_id'])
+
+sqlalchemy.ForeignKeyConstraint(
+        [endpoint['endpoint_template_id']],
+        [endpoint_template['id']])
+
+
+# user_roles
+
+user_role = {}
+user_role['id'] = sqlalchemy.Column('id', sqlalchemy.Integer, primary_key=True)
+user_role['user_id'] = sqlalchemy.Column('user_id', sqlalchemy.Integer)
+user_role['role_id'] = sqlalchemy.Column('role_id', sqlalchemy.Integer)
+user_role['tenant_id'] = sqlalchemy.Column('tenant_id', sqlalchemy.Integer)
+user_roles = sqlalchemy.Table('user_roles', meta, *user_role.values())
+
+sqlalchemy.UniqueConstraint(
+        user_role['user_id'], user_role['role_id'], user_role['tenant_id'])
+
+sqlalchemy.ForeignKeyConstraint(
+        [user_role['user_id']],
+        [user['id']])
+sqlalchemy.ForeignKeyConstraint(
+        [user_role['role_id']],
+        [role['id']])
+sqlalchemy.ForeignKeyConstraint(
+        [user_role['tenant_id']],
+        [tenant['id']])
+
+
+def upgrade(migrate_engine):
+    meta.bind = migrate_engine
+
+    user_roles.create()
+    endpoints.create()
+    roles.create()
+    services.create()
+    tenants.create()
+    users.create()
+    credentials.create()
+    tokens.create()
+    endpoint_templates.create()
+
+
+def downgrade(migrate_engine):
+    meta.bind = migrate_engine
+
+    user_roles.drop()
+    endpoints.drop()
+    roles.drop()
+    services.drop()
+    tenants.drop()
+    users.drop()
+    credentials.drop()
+    tokens.drop()
+    endpoint_templates.drop()
diff -Naur keystone/keystone/common/config.py keystone-new/keystone/common/config.py
--- keystone/keystone/common/config.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/common/config.py	2011-11-15 14:11:29.000000000 -0600
@@ -47,7 +47,8 @@
     :param parser: The option parser
     :param cli_args: (Optional) Set of arguments to process. If not present,
                      sys.argv[1:] is used.
-    :retval tuple of (options, args)
+    :returns: tuple of (options, args)
+
     """
 
     (options, args) = parser.parse_args(cli_args)
@@ -187,14 +188,16 @@
     * If --config-file option is used, use that
     * If args[0] is a file, use that
     * Search for keystone.conf in standard directories:
-        * .
-        * ~.keystone/
-        * ~
-        * /etc/keystone
-        * /etc
-    :if no config file is given get from possible_topdir/etc/keystone.conf
 
-    :retval Full path to config file, or None if no config file found
+      * .
+      * ~.keystone/
+      * ~
+      * /etc/keystone
+      * /etc
+
+    If no config file is given get from possible_topdir/etc/keystone.conf
+
+    :returns: Full path to config file, or None if no config file found
     """
     POSSIBLE_TOPDIR = os.path.normpath(os.path.join(\
                     os.path.abspath(sys.argv[0]),
@@ -234,9 +237,11 @@
     config file path and a configuration mapping from a paste config file.
 
     We search for the paste config file in the following order:
+
     * If --config-file option is used, use that
     * If args[0] is a file, use that
     * Search for keystone.conf in standard directories:
+
         * .
         * ~.keystone/
         * ~
@@ -248,10 +253,9 @@
                      the config file.
     :param options: Set of typed options returned from parse_options()
     :param args: Command line arguments from argv[1:]
-    :retval Tuple of (conf_file, conf)
-
-    :raises RuntimeError when config file cannot be located or there was a
-            problem loading the configuration file.
+    :returns: Tuple of (conf_file, conf)
+    :raises: RuntimeError when config file cannot be located or there was a
+             problem loading the configuration file.
     """
     conf_file = find_config_file(options, args)
     if not conf_file:
@@ -299,6 +303,7 @@
     * If --config-file option is used, use that
     * If args[0] is a file, use that
     * Search for keystone.conf in standard directories:
+
         * .
         * ~.keystone/
         * ~
@@ -308,15 +313,15 @@
     :param app_name: Name of the application to load (server, admin, proxy, ..)
     :param options: Set of typed options returned from parse_options()
     :param args: Command line arguments from argv[1:]
-
-    :raises RuntimeError when config file cannot be located or application
-            cannot be loaded from config file
+    :raises: RuntimeError when config file cannot be located or application
+             cannot be loaded from config file
     """
     conf_file, conf = load_paste_config(app_name, options, args)
 
     try:
         # Setup logging early, supplying both the CLI options and the
         # configuration mapping from the config file
+        options['log_file'] = "%s.log" % app_name
         setup_logging(options, conf)
 
         # We only update the conf dict for the verbose and debug
diff -Naur keystone/keystone/common/wsgi.py keystone-new/keystone/common/wsgi.py
--- keystone/keystone/common/wsgi.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/common/wsgi.py	2011-11-15 14:12:31.000000000 -0600
@@ -183,6 +183,14 @@
         print
 
 
+def debug_filter_factory(global_conf):
+    """Filter factor to easily insert a debugging middleware into the
+    paste.deploy pipeline"""
+    def filter(app):
+        return Debug(app)
+    return filter
+
+
 class Router(object):
     """
     WSGI middleware that maps incoming requests to WSGI apps.
diff -Naur keystone/keystone/config.py keystone-new/keystone/config.py
--- keystone/keystone/config.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/config.py	2011-11-15 14:11:29.000000000 -0600
@@ -1,5 +1,4 @@
-VERSION_STATUS = "ALPHA"
-VERSION_DATE = "2011-04-23T00:00:00Z"
+"""TODO: This file should be dissolved"""
 
 from keystone.logic.service import IdentityService
 SERVICE = IdentityService()
diff -Naur keystone/keystone/content/admin/identity-admin.wadl keystone-new/keystone/content/admin/identity-admin.wadl
--- keystone/keystone/content/admin/identity-admin.wadl	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/admin/identity-admin.wadl	2011-11-15 14:12:31.000000000 -0600
@@ -305,10 +305,7 @@
                 </doc>
             </param>
         </request>
-        <response status="200 203">
-            <representation mediaType="application/xml" element="identity:access"/>
-            <representation mediaType="application/json"/>
-        </response>
+        <response status="200 203"/>
         &commonFaults;
         &getFaults;
     </method>
diff -Naur keystone/keystone/content/admin/version.json.tpl keystone-new/keystone/content/admin/version.json.tpl
--- keystone/keystone/content/admin/version.json.tpl	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/admin/version.json.tpl	2011-11-15 14:11:29.000000000 -0600
@@ -1,17 +1,22 @@
 {
     "version" : {
-        "id" : "v2.0",
-        "status" : "{{VERSION_STATUS}}",
-        "updated" : "{{VERSION_DATE}}",
+        "id" : "v{{API_VERSION}}",
+        "status" : "{{API_VERSION_STATUS}}",
+        "updated" : "{{API_VERSION_DATE}}",
         "links": [
             {
                 "rel" : "self",
-                "href" : "http://{{HOST}}:{{PORT}}/v2.0/"
+                "href" : "http://{{HOST}}:{{PORT}}/v{{API_VERSION}}/"
+            },
+            {
+                "rel" : "describedby",
+                "type" : "text/html",
+                "href" : "http://docs.openstack.org/api/openstack-identity-service/{{API_VERSION}}/content/"
             },
             {
                 "rel" : "describedby",
                 "type" : "application/pdf",
-                "href" : "http://{{HOST}}:{{PORT}}/v2.0/identityadminguide.pdf"
+                "href" : "http://docs.openstack.org/api/openstack-identity-service/{{API_VERSION}}/identity-dev-guide-{{API_VERSION}}.pdf"
             },
             {
                 "rel" : "describedby",
@@ -22,11 +27,11 @@
         "media-types": [
             {
                 "base" : "application/xml",
-                "type" : "application/vnd.openstack.identity-v2.0+xml"
+                "type" : "application/vnd.openstack.identity-v{{API_VERSION}}+xml"
             },
             {
                 "base" : "application/json",
-                "type" : "application/vnd.openstack.identity-v2.0+json"
+                "type" : "application/vnd.openstack.identity-v{{API_VERSION}}+json"
             }
         ]
     }
diff -Naur keystone/keystone/content/admin/version.xml.tpl keystone-new/keystone/content/admin/version.xml.tpl
--- keystone/keystone/content/admin/version.xml.tpl	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/admin/version.xml.tpl	2011-11-15 14:11:29.000000000 -0600
@@ -1,21 +1,25 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <version xmlns="http://docs.openstack.org/common/api/v2.0"
          xmlns:atom="http://www.w3.org/2005/Atom"
-         id="v2.0" status="{{VERSION_STATUS}}" updated="{{VERSION_DATE}}">
+         id="v{{API_VERSION}}" status="{{API_VERSION_STATUS}}" updated="{{API_VERSION_DATE}}">
 
     <media-types>
         <media-type base="application/xml"
-                    type="application/vnd.openstack.identity-v2.0+xml"/>
+                    type="application/vnd.openstack.identity-v{{API_VERSION}}+xml"/>
         <media-type base="application/json"
-                    type="application/vnd.openstack.identity-v2.0+json"/>
+                    type="application/vnd.openstack.identity-v{{API_VERSION}}+json"/>
     </media-types>
 
      <atom:link rel="self"
-                href="http://{{HOST}}:{{PORT}}/v2.0/"/>
+                href="http://{{HOST}}:{{PORT}}/v{{API_VERSION}}/"/>
+
+     <atom:link rel="describedby"
+                type="text/html"
+                href="http://docs.openstack.org/api/openstack-identity-service/{{API_VERSION}}/content/" />
 
      <atom:link rel="describedby"
                 type="application/pdf"
-                href="http://{{HOST}}:{{PORT}}/v2.0/identitydevguide.pdf" />
+                href="http://docs.openstack.org/api/openstack-identity-service/{{API_VERSION}}/identity-dev-guide-{{API_VERSION}}.pdf" />
 
      <atom:link rel="describedby"
                 type="application/vnd.sun.wadl+xml"
diff -Naur keystone/keystone/content/common/samples/auth.json keystone-new/keystone/content/common/samples/auth.json
--- keystone/keystone/content/common/samples/auth.json	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/common/samples/auth.json	2011-11-15 14:11:29.000000000 -0600
@@ -4,21 +4,21 @@
             "id":"ab48a9efdfedb23ty3494",
             "expires":"2010-11-01T03:32:15-05:00",
             "tenant":{
-                "id": "345",
+                "id": "t1000",
                 "name": "My Project"
             }
         },
         "user":{
-            "id":"123",
+            "id":"u123",
             "name":"jqsmith",
             "roles":[{
-                    "id":"234",
+                    "id":"100",
                     "name":"compute:admin"
                 },
 				{
-                    "id":"235",
+                    "id":"101",
                     "name":"object-store:admin",
-                    "tenantId":"1"
+                    "tenantId":"t1000"
                 }                       
             ],
             "roles_links":[]
@@ -27,22 +27,22 @@
                 "name":"Cloud Servers",
                 "type":"compute",
                 "endpoints":[{
-                        "tenantId":"1",
-                        "publicURL":"https://compute.north.host/v1/1234",
-                        "internalURL":"https://compute.north.host/v1/1234",
+                        "tenantId":"t1000",
+                        "publicURL":"https://compute.north.host.com/v1/t1000",
+                        "internalURL":"https://compute.north.internal/v1/t1000",
                         "region":"North",
-                        "versionId":"1.0",
-                        "versionInfo":"https://compute.north.host/v1.0/",
-                        "versionList":"https://compute.north.host/"
+                        "versionId":"1",
+                        "versionInfo":"https://compute.north.host.com/v1/",
+                        "versionList":"https://compute.north.host.com/"
                     },
                     {
-                        "tenantId":"2",
-                        "publicURL":"https://compute.north.host/v1.1/3456",
-                        "internalURL":"https://compute.north.host/v1.1/3456",
+                        "tenantId":"t1000",
+                        "publicURL":"https://compute.north.host.com/v1.1/t1000",
+                        "internalURL":"https://compute.north.internal/v1.1/t1000",
                         "region":"North",
                         "versionId":"1.1",
-                        "versionInfo":"https://compute.north.host/v1.1/",
-                        "versionList":"https://compute.north.host/"
+                        "versionInfo":"https://compute.north.host.com/v1.1/",
+                        "versionList":"https://compute.north.host.com/"
                     }
                 ],
                 "endpoints_links":[]
@@ -51,35 +51,37 @@
                 "name":"Cloud Files",
                 "type":"object-store",
                 "endpoints":[{
-                        "tenantId":"11",
-                        "publicURL":"https://compute.north.host/v1/blah-blah",
-                        "internalURL":"https://compute.north.host/v1/blah-blah",
-                        "region":"South",
-                        "versionId":"1.0",
-                        "versionInfo":"uri",
-                        "versionList":"uri"
+                        "tenantId":"t1000",
+                        "publicURL":"https://storage.north.host.com/v1/t1000",
+                        "internalURL":"https://storage.north.internal/v1/t1000",
+                        "region":"North",
+                        "versionId":"1",
+                        "versionInfo":"https://storage.north.host.com/v1/",
+                        "versionList":"https://storage.north.host.com/"
                     },
                     {
-                        "tenantId":"2",
-                        "publicURL":"https://compute.north.host/v1.1/blah-blah",
-                        "internalURL":"https://compute.north.host/v1.1/blah-blah",
+                        "tenantId":"t1000",
+                        "publicURL":"https://storage.south.host.com/v1/t1000",
+                        "internalURL":"https://storage.south.internal/v1/t1000",
                         "region":"South",
-                        "versionId":"1.1",
-                        "versionInfo":"https://compute.north.host/v1.1/",
-                        "versionList":"https://compute.north.host/"
+                        "versionId":"1",
+                        "versionInfo":"https://storage.south.host.com/v1/",
+                        "versionList":"https://storage.south.host.com/"
                     }
-                ],
-                "endpoints_links":[{
-                        "rel":"next",
-                        "href":"https://identity.north.host/v2.0/endpoints?marker=2"
+                ]
+            },
+            {
+                "name":"DNS-as-a-Service",
+                "type":"dnsextension:dns",
+                "endpoints":[{
+                        "tenantId":"t1000",
+                        "publicURL":"https://dns.host.com/v2.0/t1000",
+                        "versionId":"2.0",
+                        "versionInfo":"https://dns.host.com/v2.0/",
+                        "versionList":"https://dns.host.com/"
                     }
                 ]
             }
-        ],
-        "serviceCatalog_links":[{
-                "rel":"next",
-                "href":"https://identity.host/v2.0/endpoints?session=2hfh8Ar&marker=2"
-            }
         ]
     }
 }
diff -Naur keystone/keystone/content/common/samples/auth.xml keystone-new/keystone/content/common/samples/auth.xml
--- keystone/keystone/content/common/samples/auth.xml	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/common/samples/auth.xml	2011-11-15 14:11:29.000000000 -0600
@@ -1,69 +1,69 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <access xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
-xmlns="http://docs.openstack.org/identity/api/v2.0">
+	xmlns="http://docs.openstack.org/identity/api/v2.0">
 	<token id="ab48a9efdfedb23ty3494" expires="2010-11-01T03:32:15-05:00">
-		<tenant id="456" name="My Project" />
+		<tenant id="t1000" name="My Project" />
 	</token>
-	<user id="testId" name="test">
+	<user id="u123" name="jqsmith">
 		<roles>
-			<role id="123" name="compute:admin"/>
-			<role id="234" name="object-store:admin" tenantId="1"/>
+			<role id="100" name="compute:admin"/>
+			<role id="101" name="object-store:admin" tenantId="t1000"/>
 		</roles>
 	</user>
 	<serviceCatalog>
-		<service type="compute" name="Computers in the Cloud">
+		<service type="compute" name="Cloud Servers">
 			<endpoint
-            tenantId="3456"
-			region="North"
-			publicURL="https://north.compute.public.com/v2.0/1234"
-			internalURL="https://north.compute.internal.com/v2.0/1234">
+        tenantId="t1000"
+				region="North"
+				publicURL="https://compute.north.host.com/v1/t1000"
+				internalURL="https://compute.north.host.internal/v1/t1000">
 				<version
-				id="2.0"
-				info="https://north.compute.public.com/v2.0/"
-				list="https://north.compute.public.com/" 
-				tenantId="1"/>
+				id="1"
+				info="https://compute.north.host.com/v1/"
+				list="https://compute.north.host.com/"
+				/>
 			</endpoint>
 			<endpoint
-            tenantId="3456"
-			region="South"
-			publicURL="https://south.compute.public.com/v2.0/3456"
-			internalURL="https://south.compute.internal.com/v2.0/3456">
+        tenantId="t1000"
+				region="North"
+				publicURL="https://compute.north.host.com/v1.1/t1000"
+				internalURL="https://compute.north.host.internal/v1.1/t1000">
 				<version
-				id="2.0"
-				info="https://south.compute.public.com/v2.0/"
-				list="https://south.compute.public.com/" />
+				id="1.1"
+				info="https://compute.north.host.com/v1.1/"
+				list="https://compute.north.host.com/" />
 			</endpoint>
 		</service>
-		<service type="object-store" name="HTTP Object Store">
+		<service type="object-store" name="Cloud Files">
 			<endpoint
-            tenantId="3456"
-			region="North"
-			publicURL="https://north.object-store.public.com/v1/1234"
-			internalURL="https://north.object-store.internal.com/v1/1234">
+        tenantId="t1000"
+				region="North"
+				publicURL="https://storage.north.host.com/v1/t1000"
+				internalURL="https://storage.north.host.internal/v1/t1000">
 				<version
 				id="1"
-				info="https://north.object-store.public.com/v1/"
-				list="https://north.object-store.public.com/" />
+				info="https://storage.north.host.com/v1/"
+				list="https://storage.north.host.com/" />
 			</endpoint>
 			<endpoint
-            tenantId="3456"
-			region="South"
-			publicURL="https://south.object-store.public.com/v2.0/3456"
-			internalURL="https://south.object-store.internal.com/v2.0/3456">
+        tenantId="t1000"
+				region="South"
+				publicURL="https://storage.south.host.com/v1/t1000"
+				internalURL="https://storage.south.host.internal/v1/t1000">
 				<version
-				id="2.0"
-				info="https://south.object-store.public.com/v1/"
-				list="https://south.object-store.public.com/" />
+				id="1"
+				info="https://storage.south.host.com/v1/"
+				list="https://storage.south.host.com/" />
 			</endpoint>
 		</service>
 		<service type="dnsextension:dns" name="DNS-as-a-Service">
 			<endpoint
-            tenantId="3456"
-			publicURL="https://dns.public.com/v2.0/blah-blah">
+        tenantId="t1000"
+				publicURL="https://dns.host.com/v2.0/t1000">
 				<version
 				id="2.0"
-				info="https://dns.public.com/v2.0/"
-				list="https://dns.public.com/" />
+				info="https://dns.host.com/v2.0/"
+				list="https://dns.host.com/" />
 			</endpoint>
 		</service>
 	</serviceCatalog>
diff -Naur keystone/keystone/content/common/samples/endpoint.json keystone-new/keystone/content/common/samples/endpoint.json
--- keystone/keystone/content/common/samples/endpoint.json	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/common/samples/endpoint.json	2011-11-15 14:11:29.000000000 -0600
@@ -6,6 +6,7 @@
   "type": "compute",
   "publicURL": "https://compute.north.public.com/v1",
   "internalURL": "https://compute.north.internal.com/v1",
+  "adminURL" : "https://compute.north.internal.com/v1",
   "versionId": "1",
   "versionInfo": "https://compute.north.public.com/v1/",
   "versionList": "https://compute.north.public.com/"
diff -Naur keystone/keystone/content/common/samples/endpoints.json keystone-new/keystone/content/common/samples/endpoints.json
--- keystone/keystone/content/common/samples/endpoints.json	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/common/samples/endpoints.json	2011-11-15 14:11:29.000000000 -0600
@@ -6,6 +6,7 @@
                 "type":"compute",
                 "publicURL":"https://compute.north.public.com/v1",
                 "internalURL":"https://compute.north.internal.com/v1",
+                "adminURL" : "https://compute.north.internal.com/v1",
                 "versionId":"1",
                 "versionInfo":"https://compute.north.public.com/v1/",
                 "versionList":"https://compute.north.public.com/"
@@ -17,6 +18,7 @@
                 "type":"compute",
                 "publicURL":"https://compute.north.public.com/v1",
                 "internalURL":"https://compute.north.internal.com/v1",
+                "adminURL" : "https://compute.north.internal.com/v1",
                 "versionId":"1",
                 "versionInfo":"https://compute.north.public.com/v1/",
                 "versionList":"https://compute.north.public.com/"
@@ -28,6 +30,7 @@
                 "type":"compute",
                 "publicURL":"https://compute.north.public.com/v1",
                 "internalURL":"https://compute.north.internal.com/v1",
+                "adminURL" : "https://compute.north.internal.com/v1",
                 "versionId":"1",
                 "versionInfo":"https://compute.north.public.com/v1/",
                 "versionList":"https://compute.north.public.com/"
@@ -39,6 +42,7 @@
                 "type":"compute",
                 "publicURL":"https://compute.north.public.com/v1",
                 "internalURL":"https://compute.north.internal.com/v1",
+                "adminURL" : "https://compute.north.internal.com/v1",
                 "versionId":"1",
                 "versionInfo":"https://compute.north.public.com/v1/",
                 "versionList":"https://compute.north.public.com/"
@@ -50,6 +54,7 @@
                 "type":"compute",
                 "publicURL":"https://compute.north.public.com/v1",
                 "internalURL":"https://compute.north.internal.com/v1",
+                "adminURL" : "https://compute.north.internal.com/v1",
                 "versionId":"1",
                 "versionInfo":"https://compute.north.public.com/v1/",
                 "versionList":"https://compute.north.public.com/"
diff -Naur keystone/keystone/content/common/xsd/roles.xsd keystone-new/keystone/content/common/xsd/roles.xsd
--- keystone/keystone/content/common/xsd/roles.xsd	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/common/xsd/roles.xsd	2011-11-15 14:11:29.000000000 -0600
@@ -47,10 +47,6 @@
 
     <!-- Complex Types -->
     <complexType name="Role">
-        <sequence>
-            <element vc:minVersion="1.1" ref="atom:link" minOccurs="0" maxOccurs="unbounded" />
-            <any namespace="##other" processContents="lax" minOccurs="0" maxOccurs="unbounded" />
-        </sequence>
         <attribute name="id" type="xsd:string" use="optional"/>
         <attribute name="name" type="xsd:string" use="required"/>
         <attribute name="description" type="xsd:string"  use="optional"/>
diff -Naur keystone/keystone/content/service/identity.wadl keystone-new/keystone/content/service/identity.wadl
--- keystone/keystone/content/service/identity.wadl	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/service/identity.wadl	2011-11-15 14:12:31.000000000 -0600
@@ -73,7 +73,7 @@
 
     <!-- Version -->
 
-    <method name="GET" id="versionDetails">
+    <method name="GET" id="getVersionInfo">
         <doc xml:lang="EN" title="Version Details">
             <p xmlns="http://www.w3.org/1999/xhtml">
                 Returns detailed information about this specific version of the API.
diff -Naur keystone/keystone/content/service/version.json.tpl keystone-new/keystone/content/service/version.json.tpl
--- keystone/keystone/content/service/version.json.tpl	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/service/version.json.tpl	2011-11-15 14:11:29.000000000 -0600
@@ -1,8 +1,8 @@
 {
     "version" : {
-        "id" : "v2.0",
-        "status" : "{{VERSION_STATUS}}",
-        "updated" : "{{VERSION_DATE}}",
+        "id" : "v{{API_VERSION}}",
+        "status" : "{{API_VERSION_STATUS}}",
+        "updated" : "{{API_VERSION_DATE}}",
         "links": [
             {
                 "rel" : "self",
@@ -10,8 +10,13 @@
             },
             {
                 "rel" : "describedby",
+                "type" : "text/html",
+                "href" : "http://docs.openstack.org/api/openstack-identity-service/{{API_VERSION}}/content/"
+            },
+            {
+                "rel" : "describedby",
                 "type" : "application/pdf",
-                "href" : "http://{{HOST}}:{{PORT}}/v2.0/identitydevguide.pdf"
+                "href" : "http://docs.openstack.org/api/openstack-identity-service/{{API_VERSION}}/identity-dev-guide-{{API_VERSION}}.pdf"
             },
             {
                 "rel" : "describedby",
diff -Naur keystone/keystone/content/service/version.xml.tpl keystone-new/keystone/content/service/version.xml.tpl
--- keystone/keystone/content/service/version.xml.tpl	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/content/service/version.xml.tpl	2011-11-15 14:11:29.000000000 -0600
@@ -1,21 +1,25 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <version xmlns="http://docs.openstack.org/common/api/v2.0"
          xmlns:atom="http://www.w3.org/2005/Atom"
-         id="v2.0" status="{{VERSION_STATUS}}" updated="{{VERSION_DATE}}">
+         id="v{{API_VERSION}}" status="{{API_VERSION_STATUS}}" updated="{{API_VERSION_DATE}}">
 
     <media-types>
         <media-type base="application/xml"
-                    type="application/vnd.openstack.identity-v2.0+xml"/>
+                    type="application/vnd.openstack.identity-v{{API_VERSION}}+xml"/>
         <media-type base="application/json"
-                    type="application/vnd.openstack.identity-v2.0+json"/>
+                    type="application/vnd.openstack.identity-v{{API_VERSION}}+json"/>
     </media-types>
 
      <atom:link rel="self"
-                href="http://{{HOST}}:{{PORT}}/v2.0/"/>
+                href="http://{{HOST}}:{{PORT}}/v{{API_VERSION}}/"/>
+
+     <atom:link rel="describedby"
+                type="text/html"
+                href="http://docs.openstack.org/api/openstack-identity-service/{{API_VERSION}}/content/" />
 
      <atom:link rel="describedby"
                 type="application/pdf"
-                href="http://{{HOST}}:{{PORT}}/v2.0/identitydevguide.pdf" />
+                href="http://docs.openstack.org/api/openstack-identity-service/{{API_VERSION}}/identity-dev-guide-{{API_VERSION}}.pdf" />
 
      <atom:link rel="describedby"
                 type="application/vnd.sun.wadl+xml"
diff -Naur keystone/keystone/contrib/extensions/service/raxgrp/api.py keystone-new/keystone/contrib/extensions/service/raxgrp/api.py
--- keystone/keystone/contrib/extensions/service/raxgrp/api.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/contrib/extensions/service/raxgrp/api.py	2011-11-15 14:11:29.000000000 -0600
@@ -16,7 +16,7 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-import keystone.backends.api
+from keystone.backends.api import BaseUserAPI
 
 
 #Base APIs
diff -Naur keystone/keystone/controllers/roles.py keystone-new/keystone/controllers/roles.py
--- keystone/keystone/controllers/roles.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/controllers/roles.py	2011-11-15 14:12:31.000000000 -0600
@@ -59,4 +59,4 @@
     def add_global_role_to_user(self, req, user_id, role_id):
         config.SERVICE.add_global_role_to_user(utils.get_auth_token(req),
             user_id, role_id)
-        return utils.send_result(201)
+        return utils.send_result(201, None)
diff -Naur keystone/keystone/controllers/version.py keystone-new/keystone/controllers/version.py
--- keystone/keystone/controllers/version.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/controllers/version.py	2011-11-15 14:11:29.000000000 -0600
@@ -1,16 +1,15 @@
 import os
-import sys
 from webob import Response
 
 # If ../../keystone/__init__.py exists, add ../ to Python search path, so that
 # it will override what happens to be installed in /usr/(local/)lib/python...
-possible_topdir = os.path.normpath(os.path.join(os.path.abspath(sys.argv[0]),
-                                   os.pardir,
-                                   os.pardir))
+possible_topdir = os.path.normpath(os.path.join(os.path.dirname(__file__),
+                                                os.pardir,
+                                                os.pardir))
 
+import keystone
 from keystone import utils
 from keystone.common import template, wsgi
-import keystone.config as config
 
 
 class VersionController(wsgi.Controller):
@@ -38,7 +37,8 @@
         resp.unicode_body = template.template(resp_file,
             HOST=hostname,
             PORT=port,
-            VERSION_STATUS=config.VERSION_STATUS,
-            VERSION_DATE=config.VERSION_DATE)
+            API_VERSION=keystone.API_VERSION,
+            API_VERSION_STATUS=keystone.API_VERSION_STATUS,
+            API_VERSION_DATE=keystone.API_VERSION_DATE)
 
         return resp
diff -Naur keystone/keystone/frontends/legacy_token_auth.py keystone-new/keystone/frontends/legacy_token_auth.py
--- keystone/keystone/frontends/legacy_token_auth.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/frontends/legacy_token_auth.py	2011-11-15 14:11:29.000000000 -0600
@@ -68,7 +68,7 @@
             new_request = Request.blank('/tokens')
             new_request.method = 'POST'
             new_request.headers['Content-type'] = 'application/json'
-            new_request.accept = 'text/json'
+            new_request.accept = 'application/json'
             new_request.body = json.dumps(params)
             response = new_request.get_response(self.app)
             #Handle failures.
diff -Naur keystone/keystone/__init__.py keystone-new/keystone/__init__.py
--- keystone/keystone/__init__.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/__init__.py	2011-11-15 14:12:31.000000000 -0600
@@ -12,17 +12,28 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-'''Main module for Keystone service. This installs the gettext function
-for all sub modules and packages.'''
-
 import gettext
 
-__version__ = '0.9'
 
-# This installs the _(...) function as a built-in so all other modules
-# don't need to.
-gettext.install('keystone')
+API_VERSION = "2.0"
+API_VERSION_STATUS = "ALPHA"
+API_VERSION_DATE = "2011-11-19T00:00:00Z"
+
+RELEASE_VERSION = "2011.3.1"
+RELEASE_VERSION_FINAL = True  # becomes true at Release Candidate time
+
+
+def canonical_version():
+    return RELEASE_VERSION
 
 
 def version():
-    return __version__
+    if RELEASE_VERSION_FINAL:
+        return RELEASE_VERSION
+    else:
+        return '%s-dev' % (RELEASE_VERSION)
+
+
+# This installs the _(...) function as a built-in so all other modules
+# don't need to.
+gettext.install('keystone')
diff -Naur keystone/keystone/logic/service.py keystone-new/keystone/logic/service.py
--- keystone/keystone/logic/service.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/logic/service.py	2011-11-15 14:12:31.000000000 -0600
@@ -147,20 +147,9 @@
 
     def validate_token(self, admin_token, token_id, belongs_to=None):
         self.__validate_service_or_keystone_admin_token(admin_token)
-
-        if not api.TOKEN.get(token_id):
-            raise fault.UnauthorizedFault("Bad token, please reauthenticate")
-        (token, user) = self.__validate_token(token_id, belongs_to)
+        (token, user) = self.__validate_token(token_id, belongs_to, True)
         return self.__get_validate_data(token, user)
 
-    def check_token(self, admin_token, token_id, belongs_to=None):
-        self.__validate_service_or_keystone_admin_token(admin_token)
-
-        if not api.TOKEN.get(token_id):
-            raise fault.UnauthorizedFault("Bad token, please reauthenticate")
-
-        self.__validate_token(token_id, belongs_to)
-
     def revoke_token(self, admin_token, token_id):
         self.__validate_admin_token(admin_token)
 
@@ -392,7 +381,7 @@
         if not duser:
             raise fault.ItemNotFoundFault("The user could not be found")
         return User_Update(id=duser.id, tenant_id=duser.tenant_id,
-                email=duser.email, enabled=duser.enabled)
+                email=duser.email, enabled=duser.enabled, name=duser.name)
 
     def update_user(self, admin_token, user_id, user):
         self.__validate_admin_token(admin_token)
@@ -510,7 +499,7 @@
             ts.append(UserRole(drole_ref.role_id, drole.name,
                 drole_ref.tenant_id))
 
-        user = auth.User(duser.id, duser.name, None, UserRoles(ts, []))
+        user = auth.User(duser.id, duser.name, None, None, UserRoles(ts, []))
 
         return auth.AuthData(token, user, endpoints)
 
@@ -537,8 +526,14 @@
             ts.append(UserRole(drole_ref.role_id, drole.name,
                 drole_ref.tenant_id))
 
+        # Also get the user's tenant's name
+        tenant_name = None
+        if duser.tenant_id:
+            utenant = api.TENANT.get(duser.tenant_id)
+            tenant_name = utenant.name
+
         user = auth.User(duser.id, duser.name, duser.tenant_id,
-            UserRoles(ts, []))
+            tenant_name, UserRoles(ts, []))
 
         return auth.ValidateData(token, user)
 
@@ -568,17 +563,33 @@
 
         return self.__validate_tenant(dtenant)
 
-    def __validate_token(self, token_id, belongs_to=None):
+    def __validate_token(self, token_id, belongs_to=None, is_check_token=None):
+        """
+        Method to validate a token.
+        token_id -- value of actual token that need to be validated.
+        belngs_to -- optional tenant_id to check whether the token is
+        mapped to a specific tenant.
+        is_check_token -- optional argument that tells whether
+        we check the existence of a Token using another Token
+        to authenticate.This value decides the faults that are to be thrown.
+        """
         if not token_id:
             raise fault.UnauthorizedFault("Missing token")
 
         (token, user) = self.__get_dauth_data(token_id)
 
         if not token:
-            raise fault.ItemNotFoundFault("Bad token, please reauthenticate")
+            if is_check_token:
+                raise fault.ItemNotFoundFault("Token does not exist.")
+            else:
+                raise fault.UnauthorizedFault(
+                    "Bad token, please reauthenticate")
 
         if token.expires < datetime.now():
-            raise fault.ForbiddenFault("Token expired, please renew")
+            if is_check_token:
+                raise fault.ItemNotFoundFault("Token expired, please renew.")
+            else:
+                raise fault.ForbiddenFault("Token expired, please renew.")
 
         if not user.enabled:
             raise fault.UserDisabledFault("User %s has been disabled!"
diff -Naur keystone/keystone/logic/types/auth.py keystone-new/keystone/logic/types/auth.py
--- keystone/keystone/logic/types/auth.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/logic/types/auth.py	2011-11-15 14:12:31.000000000 -0600
@@ -293,12 +293,14 @@
     id = None
     username = None
     tenant_id = None
+    tenant_name = None
     role_refs = None
 
-    def __init__(self, id, username, tenant_id, role_refs=None):
+    def __init__(self, id, username, tenant_id, tenant_name, role_refs=None):
         self.id = id
         self.username = username
         self.tenant_id = tenant_id
+        self.tenant_name = tenant_name
         self.role_refs = role_refs
 
 
@@ -444,6 +446,8 @@
 
         if self.user.tenant_id is not None:
             user.set('tenantId', unicode(self.user.tenant_id))
+            if self.user.tenant_name is not None:
+                user.set('tenantName', unicode(self.user.tenant_name))
 
         if self.user.role_refs is not None:
             user.append(self.user.role_refs.to_dom())
@@ -468,6 +472,8 @@
 
         if self.user.tenant_id is not None:
             user['tenantId'] = unicode(self.user.tenant_id)
+            if self.user.tenant_name is not None:
+                user['tenantName'] = unicode(self.user.tenant_name)
 
         if self.user.role_refs is not None:
             user["roles"] = self.user.role_refs.to_json_values()
diff -Naur keystone/keystone/manage/api.py keystone-new/keystone/manage/api.py
--- keystone/keystone/manage/api.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/manage/api.py	2011-11-15 14:12:31.000000000 -0600
@@ -28,7 +28,7 @@
     objects = db_api.USER.get_all()
     if objects == None:
         raise IndexError("No users found")
-    return [[o.id, o.enabled, o.tenant_id] for o in objects]
+    return [[o.id, o.name, o.enabled, o.tenant_id] for o in objects]
 
 
 def add_tenant(name):
diff -Naur keystone/keystone/manage/__init__.py keystone-new/keystone/manage/__init__.py
--- keystone/keystone/manage/__init__.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/manage/__init__.py	2011-11-15 14:12:31.000000000 -0600
@@ -24,7 +24,7 @@
 
 import sys
 import logging
-import optparse
+import optparse  # deprecated in 2.7, in favor of argparse
 
 import keystone
 from keystone.common import config
@@ -32,6 +32,22 @@
 import keystone.backends as db
 
 
+# CLI feature set
+OBJECTS = ['user', 'tenant', 'role', 'service',
+    'endpointTemplates', 'token', 'endpoint', 'credentials']
+ACTIONS = ['add', 'list', 'disable', 'delete', 'grant',
+    'revoke']
+
+
+# Messages
+OBJECT_NOT_SPECIFIED = 'No object type specified for first argument'
+ACTION_NOT_SPECIFIED = 'No action specified for second argument'
+ID_NOT_SPECIFIED = 'No ID specified for third argument'
+SUPPORTED_OBJECTS = "Supported objects: %s" % (", ".join(OBJECTS))
+SUPPORTED_ACTIONS = "Supported actions: %s" % (", ".join(ACTIONS))
+ACTION_NOT_SUPPORTED = 'Action not supported for %s'
+
+
 class RaisingOptionParser(optparse.OptionParser):
     def error(self, msg):
         self.print_usage(sys.stderr)
@@ -39,7 +55,23 @@
 
 
 def parse_args(args=None):
-    usage = "usage: %prog [options] type command [id [attributes]]"
+    usage = """
+    Usage: keystone-manage [options] type action [id [attributes]]
+      type       : %s
+      action     : %s
+      id         : name or id
+      attributes : depending on type...
+        users    : password, tenant
+        tokens   : user, tenant, expiration
+
+      role list [tenant] will list roles granted on that tenant
+
+    options
+      -c | --config-file : config file to use
+      -d | --debug : debug mode
+
+    Example: keystone-manage user add Admin P@ssw0rd
+    """ % (", ".join(OBJECTS), ", ".join(ACTIONS))
 
     # Initialize a parser for our configuration paramaters
     parser = RaisingOptionParser(usage, version='%%prog %s'
@@ -59,46 +91,24 @@
 
 
 def process(*args):
-    """
-    Usage: keystone-manage [options] type command [id [attributes]]
-      type       : role, tenant, user, token, endpoint, endpointTemplates
-      command    : add, list, disable, delete, grant, revoke
-      id         : name or id
-      attributes : depending on type...
-        users    : password, tenant
-        tokens   : user, tenant, expiration
-
-      role list [tenant] will list roles granted on that tenant
-
-    options
-      -c | --config-file : config file to use
-      -d | --debug : debug mode
-
-    Example: keystone-manage user add Admin P@ssw0rd
-    """
     # Check arguments
     if len(args) == 0:
-        raise optparse.OptParseError(
-            'No obj type specified for first argument')
-
-    object_type = args[0]
-    if object_type not in ['user', 'tenant', 'role', 'service',
-            'endpointTemplates', 'token', 'endpoint', 'credentials']:
-        raise optparse.OptParseError(
-            '%s is not a supported obj type' % object_type)
+        raise optparse.OptParseError(OBJECT_NOT_SPECIFIED)
+    else:
+        object_type = args[0]
+        if object_type not in OBJECTS:
+            raise optparse.OptParseError(SUPPORTED_OBJECTS)
 
     if len(args) == 1:
-        raise optparse.OptParseError(
-            'No command specified for second argument')
-    command = args[1]
-    if command not in ['add', 'list', 'disable', 'delete', 'grant', 'revoke']:
-        raise optparse.OptParseError('add, disable, delete, and list are the '
-            'only supported commands (right now)')
-
-    if len(args) == 2:
-        if command != 'list':
-            raise optparse.OptParseError('No id specified for third argument')
-    if len(args) > 2:
+        raise optparse.OptParseError(ACTION_NOT_SPECIFIED)
+    else:
+        action = args[1]
+        if action not in ACTIONS:
+            raise optparse.OptParseError(SUPPORTED_ACTIONS)
+
+    if len(args) == 2 and action not in ['list']:
+        raise optparse.OptParseError(ID_NOT_SPECIFIED)
+    else:
         object_id = args[2]
 
     # Helper functions
@@ -118,36 +128,41 @@
         print "\n".join(["\t".join(row) for row in rows])
 
     # Execute command
-
-    if (object_type, command) == ('user', 'add'):
+    if (object_type, action) == ('user', 'add'):
         require_args(args, 4, 'No password specified for fourth argument')
         if api.add_user(name=object_id, password=args[3],
                 tenant=optional_arg(args, 4)):
             print "SUCCESS: User %s created." % object_id
 
-    elif (object_type, command) == ('user', 'disable'):
+    elif (object_type, action) == ('user', 'list'):
+        print_table(('id', 'name', 'enabled', 'tenant'), api.list_users())
+
+    elif (object_type, action) == ('user', 'disable'):
         if api.disable_user(name=object_id):
             print "SUCCESS: User %s disabled." % object_id
 
-    elif (object_type, command) == ('user', 'list'):
-        print_table(('id', 'enabled', 'tenant'), api.list_users())
+    elif object_type == 'user':
+        raise optparse.OptParseError(ACTION_NOT_SUPPORTED % ('users'))
 
-    elif (object_type, command) == ('tenant', 'add'):
+    elif (object_type, action) == ('tenant', 'add'):
         if api.add_tenant(name=object_id):
             print "SUCCESS: Tenant %s created." % object_id
 
-    elif (object_type, command) == ('tenant', 'list'):
+    elif (object_type, action) == ('tenant', 'list'):
         print_table(('id', 'name', 'enabled'), api.list_tenants())
 
-    elif (object_type, command) == ('tenant', 'disable'):
+    elif (object_type, action) == ('tenant', 'disable'):
         if api.disable_tenant(name=object_id):
             print "SUCCESS: Tenant %s disabled." % object_id
 
-    elif (object_type, command) == ('role', 'add'):
+    elif object_type == 'tenant':
+        raise optparse.OptParseError(ACTION_NOT_SUPPORTED % ('tenants'))
+
+    elif (object_type, action) == ('role', 'add'):
         if api.add_role(name=object_id):
             print "SUCCESS: Role %s created successfully." % object_id
 
-    elif (object_type, command) == ('role', 'list'):
+    elif (object_type, action) == ('role', 'list'):
         tenant = optional_arg(args, 2)
         if tenant:
             # print with users
@@ -157,7 +172,7 @@
             # print without tenants
             print_table(('id', 'name'), api.list_roles())
 
-    elif (object_type, command) == ('role', 'grant'):
+    elif (object_type, action) == ('role', 'grant'):
         require_args(args, 4, "Missing arguments: role grant 'role' 'user' "
             "'tenant (optional)'")
         tenant = optional_arg(args, 4)
@@ -165,7 +180,10 @@
             print("SUCCESS: Granted %s the %s role on %s." %
                 (object_id, args[3], tenant))
 
-    elif (object_type, command) == ('endpointTemplates', 'add'):
+    elif object_type == 'role':
+        raise optparse.OptParseError(ACTION_NOT_SUPPORTED % ('roles'))
+
+    elif (object_type, action) == ('endpointTemplates', 'add'):
         require_args(args, 9, "Missing arguments: endpointTemplates add "
             "'region' 'service' 'publicURL' 'adminURL' 'internalURL' "
             "'enabled' 'global'")
@@ -175,7 +193,7 @@
             print("SUCCESS: Created EndpointTemplates for %s pointing to %s." %
                 (args[3], args[4]))
 
-    elif (object_type, command) == ('endpointTemplates', 'list'):
+    elif (object_type, action) == ('endpointTemplates', 'list'):
         tenant = optional_arg(args, 2)
         if tenant:
             print 'Endpoints for tenant %s' % tenant
@@ -186,29 +204,39 @@
             print_table(('service', 'region', 'Public URL'),
                 api.list_endpoint_templates())
 
-    elif (object_type, command) == ('endpoint', 'add'):
+    elif object_type == 'endpointTemplates':
+        raise optparse.OptParseError(ACTION_NOT_SUPPORTED % (
+            'endpointTemplates'))
+
+    elif (object_type, action) == ('endpoint', 'add'):
         require_args(args, 4, "Missing arguments: endPoint add tenant "
             "endPointTemplate")
         if api.add_endpoint(tenant=args[2], endpoint_template=args[3]):
             print("SUCCESS: Endpoint %s added to tenant %s." %
                 (args[3], args[2]))
 
-    elif (object_type, command) == ('token', 'add'):
+    elif object_type == 'endpoint':
+        raise optparse.OptParseError(ACTION_NOT_SUPPORTED % ('endpoints'))
+
+    elif (object_type, action) == ('token', 'add'):
         require_args(args, 6, 'Creating a token requires a token id, user, '
             'tenant, and expiration')
         if api.add_token(token=object_id, user=args[3], tenant=args[4],
                 expires=args[5]):
             print "SUCCESS: Token %s created." % (object_id,)
 
-    elif (object_type, command) == ('token', 'list'):
+    elif (object_type, action) == ('token', 'list'):
         print_table(('token', 'user', 'expiration', 'tenant'),
             api.list_tokens())
 
-    elif (object_type, command) == ('token', 'delete'):
+    elif (object_type, action) == ('token', 'delete'):
         if api.delete_token(token=object_id):
             print 'SUCCESS: Token %s deleted.' % (object_id,)
 
-    elif (object_type, command) == ('service', 'add'):
+    elif object_type == 'token':
+        raise optparse.OptParseError(ACTION_NOT_SUPPORTED % ('tokens'))
+
+    elif (object_type, action) == ('service', 'add'):
         require_args(args, 4, "Missing arguments: service add name "
             "type")
         type = optional_arg(args, 3)
@@ -216,19 +244,25 @@
         if api.add_service(name=object_id, type=type, desc=desc):
             print "SUCCESS: Service %s created successfully." % (object_id,)
 
-    elif (object_type, command) == ('service', 'list'):
+    elif (object_type, action) == ('service', 'list'):
         print_table(('id', 'name', 'type'), api.list_services())
 
-    elif (object_type, command) == ('credentials', 'add'):
+    elif object_type == 'service':
+        raise optparse.OptParseError(ACTION_NOT_SUPPORTED % ('services'))
+
+    elif (object_type, action) == ('credentials', 'add'):
         require_args(args, 6, 'Creating a credentials requires a type, key, '
             'secret, and tenant_id (id is user_id)')
         if api.add_credentials(user=object_id, type=args[3], key=args[4],
                 secrete=args[5], tenant=optional_arg(args, 6)):
             print "SUCCESS: Credentials %s created." % object_id
 
+    elif object_type == 'credentials':
+        raise optparse.OptParseError(ACTION_NOT_SUPPORTED % ('credentials'))
+
     else:
-        # Command not handled
-        print ("ERROR: unrecognized command %s %s" % (object_type, command))
+        # Command recognized but not handled: should never reach this
+        raise NotImplementedError()
 
 
 def main(args=None):
diff -Naur keystone/keystone/middleware/auth_basic.py keystone-new/keystone/middleware/auth_basic.py
--- keystone/keystone/middleware/auth_basic.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/middleware/auth_basic.py	2011-11-15 14:12:31.000000000 -0600
@@ -21,10 +21,11 @@
 BASIC AUTH MIDDLEWARE - STUB
 
 This WSGI component should perform multiple jobs:
-- validate incoming basic claims
-- perform all basic auth interactions with clients
-- collect and forward identity information from the authentication process
-    such as user name, groups, etc...
+
+* validate incoming basic claims
+* perform all basic auth interactions with clients
+* collect and forward identity information from the authentication process
+  such as user name, groups, etc...
 
 This is an Auth component as per: http://wiki.openstack.org/openstack-authn
 
diff -Naur keystone/keystone/middleware/auth_token.py keystone-new/keystone/middleware/auth_token.py
--- keystone/keystone/middleware/auth_token.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/middleware/auth_token.py	2011-11-15 14:12:31.000000000 -0600
@@ -20,32 +20,48 @@
 TOKEN-BASED AUTH MIDDLEWARE
 
 This WSGI component performs multiple jobs:
-- it verifies that incoming client requests have valid tokens by verifying
-    tokens with the auth service.
-- it will reject unauthenticated requests UNLESS it is in 'delay_auth_decision'
-    mode, which means the final decision is delegated to the downstream WSGI
-    component (usually the OpenStack service)
-- it will collect and forward identity information from a valid token
-    such as user name etc...
+
+* it verifies that incoming client requests have valid tokens by verifying
+  tokens with the auth service.
+* it will reject unauthenticated requests UNLESS it is in 'delay_auth_decision'
+  mode, which means the final decision is delegated to the downstream WSGI
+  component (usually the OpenStack service)
+* it will collect and forward identity information from a valid token
+  such as user name etc...
 
 Refer to: http://wiki.openstack.org/openstack-authn
 
 
 HEADERS
 -------
-Headers starting with HTTP_ is a standard http header
-Headers starting with HTTP_X is an extended http header
 
-> Coming in from initial call from client or customer
-HTTP_X_AUTH_TOKEN   : the client token being passed in
-HTTP_X_STORAGE_TOKEN: the client token being passed in (legacy Rackspace use)
-                      to support cloud files
-> Used for communication between components
-www-authenticate    : only used if this component is being used remotely
-HTTP_AUTHORIZATION  : basic auth password used to validate the connection
+* Headers starting with HTTP\_ is a standard http header
+* Headers starting with HTTP_X is an extended http header
+
+Coming in from initial call from client or customer
+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+HTTP_X_AUTH_TOKEN
+    the client token being passed in
+
+HTTP_X_STORAGE_TOKEN
+    the client token being passed in (legacy Rackspace use) to support
+    cloud files
+
+Used for communication between components
+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+www-authenticate
+    only used if this component is being used remotely
+
+HTTP_AUTHORIZATION
+    basic auth password used to validate the connection
 
-> What we add to the request for use by the OpenStack service
-HTTP_X_AUTHORIZATION: the client identity being passed in
+What we add to the request for use by the OpenStack service
+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+HTTP_X_AUTHORIZATION
+    the client identity being passed in
 
 """
 
@@ -165,8 +181,18 @@
                 if claims:
                     self._decorate_request('X_AUTHORIZATION', "Proxy %s" %
                         claims['user'], env, proxy_headers)
+
+                    # For legacy compatibility before we had ID and Name
                     self._decorate_request('X_TENANT',
                         claims['tenant'], env, proxy_headers)
+
+                    # Services should use these
+                    self._decorate_request('X_TENANT_NAME',
+                        claims.get('tenant_name', claims['tenant']),
+                        env, proxy_headers)
+                    self._decorate_request('X_TENANT_ID',
+                        claims['tenant'], env, proxy_headers)
+
                     self._decorate_request('X_USER',
                         claims['user'], env, proxy_headers)
                     if 'roles' in claims and len(claims['roles']) > 0:
@@ -192,7 +218,8 @@
         validate a user's token. Validate_token is a priviledged call so
         it needs to be authenticated by a service that is calling it
         """
-        headers = {"Content-type": "application/json", "Accept": "text/json"}
+        headers = {"Content-type": "application/json",
+                   "Accept": "application/json"}
         params = {"passwordCredentials": {"username": username,
                                           "password": password,
                                           "tenantId": "1"}}
@@ -235,7 +262,7 @@
         # since this is a priviledged op,m we need to auth ourselves
         # by using an admin token
         headers = {"Content-type": "application/json",
-                    "Accept": "text/json",
+                    "Accept": "application/json",
                     "X-Auth-Token": self.admin_token}
                     ##TODO(ziad):we need to figure out how to auth to keystone
                     #since validate_token is a priviledged call
@@ -261,7 +288,7 @@
         # Valid token. Get user data and put it in to the call
         # so the downstream service can use it
         headers = {"Content-type": "application/json",
-                    "Accept": "text/json",
+                    "Accept": "application/json",
                     "X-Auth-Token": self.admin_token}
                     ##TODO(ziad):we need to figure out how to auth to keystone
                     #since validate_token is a priviledged call
@@ -288,13 +315,18 @@
 
         try:
             tenant = token_info['access']['token']['tenant']['id']
+            tenant_name = token_info['access']['token']['tenant']['name']
         except:
             tenant = None
+            tenant_name = None
         if not tenant:
             tenant = token_info['access']['user'].get('tenantId')
+            tenant_name = token_info['access']['user'].get('tenantName')
         verified_claims = {'user': token_info['access']['user']['username'],
                     'tenant': tenant,
                     'roles': roles}
+        if tenant_name:
+            verified_claims['tenantName'] = tenant_name
         return verified_claims
 
     def _decorate_request(self, index, value, env, proxy_headers):
diff -Naur keystone/keystone/middleware/nova_auth_token.py keystone-new/keystone/middleware/nova_auth_token.py
--- keystone/keystone/middleware/nova_auth_token.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/middleware/nova_auth_token.py	2011-11-15 14:11:29.000000000 -0600
@@ -74,7 +74,13 @@
             self.auth.modify_user(user_ref, admin=is_admin)
 
         # create a project for tenant
-        project_id = req.headers['X_TENANT']
+        if 'X_TENANT_ID' in req.headers:
+            # This is the new header since Keystone went to ID/Name
+            project_id = req.headers['X_TENANT_ID']
+        else:
+            # This is for legacy compatibility
+            project_id = req.headers['X_TENANT']
+
         if project_id:
             try:
                 project_ref = self.auth.get_project(project_id)
diff -Naur keystone/keystone/middleware/nova_keystone_context.py keystone-new/keystone/middleware/nova_keystone_context.py
--- keystone/keystone/middleware/nova_keystone_context.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/middleware/nova_keystone_context.py	2011-11-15 14:12:31.000000000 -0600
@@ -41,7 +41,14 @@
             return webob.exc.HTTPUnauthorized()
         # get the roles
         roles = [r.strip() for r in req.headers.get('X_ROLE', '').split(',')]
-        project_id = req.headers['X_TENANT']
+
+        if 'X_TENANT_ID' in req.headers:
+            # This is the new header since Keystone went to ID/Name
+            project_id = req.headers['X_TENANT_ID']
+        else:
+            # This is for legacy compatibility
+            project_id = req.headers['X_TENANT']
+
         # Get the auth token
         auth_token = req.headers.get('X_AUTH_TOKEN',
                                      req.headers.get('X_STORAGE_TOKEN'))
diff -Naur keystone/keystone/middleware/remoteauth.py keystone-new/keystone/middleware/remoteauth.py
--- keystone/keystone/middleware/remoteauth.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/middleware/remoteauth.py	2011-11-15 14:11:29.000000000 -0600
@@ -38,19 +38,34 @@
 
 HEADERS
 -------
-HTTP_ is a standard http header
-HTTP_X is an extended http header
 
-> Coming in from initial call
-HTTP_X_AUTH_TOKEN   : the client token being passed in
-HTTP_X_STORAGE_TOKEN: the client token being passed in (legacy Rackspace use)
-                      to support cloud files
-> Used for communication between components
-www-authenticate    : only used if this component is being used remotely
-HTTP_AUTHORIZATION  : basic auth password used to validate the connection
+* HTTP\_ is a standard http header
+* HTTP_X is an extended http header
 
-> What we add to the request for use by the OpenStack service
-HTTP_X_AUTHORIZATION: the client identity being passed in
+Coming in from initial call
+^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+HTTP_X_AUTH_TOKEN
+    the client token being passed in
+
+HTTP_X_STORAGE_TOKEN
+    the client token being passed in (legacy Rackspace use) to support
+    cloud files
+
+Used for communication between components
+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+www-authenticate
+    only used if this component is being used remotely
+
+HTTP_AUTHORIZATION
+    basic auth password used to validate the connection
+
+What we add to the request for use by the OpenStack service
+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+HTTP_X_AUTHORIZATION
+    the client identity being passed in
 
 
 """
diff -Naur keystone/keystone/middleware/swift_auth.py keystone-new/keystone/middleware/swift_auth.py
--- keystone/keystone/middleware/swift_auth.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/middleware/swift_auth.py	2011-11-15 14:12:31.000000000 -0600
@@ -46,7 +46,7 @@
 from keystone.common.bufferedhttp import http_connect_raw as http_connect
 
 from swift.common.middleware.acl import clean_acl, parse_acl, referrer_allowed
-from swift.common.utils import cache_from_env, get_logger, split_path
+from swift.common.utils import get_logger, split_path
 
 
 PROTOCOL_NAME = "Swift Token Authentication"
@@ -196,7 +196,7 @@
 
         self.log.debug('Asking keystone to validate token')
         headers = {"Content-type": "application/json",
-                    "Accept": "text/json",
+                    "Accept": "application/json",
                     "X-Auth-Token": self.admin_token}
         self.log.debug('headers: %r', headers)
         self.log.debug('url: %s', self.keystone_url)
@@ -213,9 +213,10 @@
         identity_info = json.loads(data)
         roles = []
         role_refs = identity_info["access"]["user"]["roles"]
+
         if role_refs is not None:
             for role_ref in role_refs:
-                roles.append(role_ref["roleId"])
+                roles.append(role_ref["id"])
 
         try:
             tenant = identity_info['access']['token']['tenantId']
diff -Naur keystone/keystone/server.py keystone-new/keystone/server.py
--- keystone/keystone/server.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/server.py	2011-11-15 14:11:29.000000000 -0600
@@ -20,19 +20,34 @@
 
 HEADERS
 -------
-HTTP_ is a standard http header
-HTTP_X is an extended http header
 
-> Coming in from initial call
-HTTP_X_AUTH_TOKEN   : the client token being passed in
-HTTP_X_STORAGE_TOKEN: the client token being passed in (legacy Rackspace use)
-                      to support cloud files
-> Used for communication between components
-www-authenticate    : only used if this component is being used remotely
-HTTP_AUTHORIZATION  : basic auth password used to validate the connection
+* HTTP\_ is a standard http header
+* HTTP_X is an extended http header
 
-> What we add to the request for use by the OpenStack SERVICE
-HTTP_X_AUTHORIZATION: the client identity being passed in
+Coming in from initial call
+^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+HTTP_X_AUTH_TOKEN
+    the client token being passed in
+
+HTTP_X_STORAGE_TOKEN
+    the client token being passed in (legacy Rackspace use) to support
+    cloud files
+
+Used for communication between components
+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+www-authenticate
+    only used if this component is being used remotely
+
+HTTP_AUTHORIZATION
+    basic auth password used to validate the connection
+
+What we add to the request for use by the OpenStack SERVICE
+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
+
+HTTP_X_AUTHORIZATION
+    the client identity being passed in
 
 """
 from keystone.routers.service import ServiceApi
diff -Naur keystone/keystone/test/functional/common.py keystone-new/keystone/test/functional/common.py
--- keystone/keystone/test/functional/common.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/functional/common.py	2011-11-15 14:12:31.000000000 -0600
@@ -6,7 +6,14 @@
 
 
 class HttpTestCase(unittest.TestCase):
-    """Performs generic HTTP request testing"""
+    """Performs generic HTTP request testing.
+
+    Defines a ``request`` method for use in test cases that makes
+    HTTP requests, and two new asserts:
+
+    * assertResponseSuccessful
+    * assertResponseStatus
+    """
 
     def request(self, host='127.0.0.1', port=80, method='GET', path='/',
             headers=None, body=None, assert_status=None):
@@ -38,13 +45,29 @@
         return response
 
     def assertResponseSuccessful(self, response):
-        """Asserts that a status code lies inside the 2xx range"""
+        """Asserts that a status code lies inside the 2xx range
+
+        :param response: :py:class:`httplib.HTTPResponse` to be
+        verified to have a status code between 200 and 299.
+
+        example::
+
+            >>> self.assertResponseSuccessful(response, 203)
+        """
         self.assertTrue(response.status >= 200 and response.status <= 299,
             'Status code %d is outside of the expected range (2xx)\n\n%s' %
             (response.status, response.body))
 
     def assertResponseStatus(self, response, assert_status):
-        """Asserts a specific status code on the response"""
+        """Asserts a specific status code on the response
+
+        :param response: :py:class:`httplib.HTTPResponse`
+        :param assert_status: The specific ``status`` result expected
+
+        example::
+
+            >>> self.assertResponseStatus(response, 203)
+        """
         self.assertEqual(response.status, assert_status,
             'Status code %s is not %s, as expected)\n\n%s' %
             (response.status, assert_status, response.body))
@@ -59,16 +82,18 @@
 
         Dynamically encodes json or xml as request body if one is provided.
 
-        WARNING: Existing Content-Type header will be overwritten.
-        WARNING: If both as_json and as_xml are provided, as_xml is ignored.
-        WARNING: If either as_json or as_xml AND a body is provided, the body
-            is ignored.
+        .. WARNING::
+           * Existing Content-Type header will be overwritten.
+           * If both as_json and as_xml are provided, as_xml is ignored.
+           * If either as_json or as_xml AND a body is provided, the body
+             is ignored.
 
         Dynamically returns 'as_json' or 'as_xml' attribute based on the
         detected response type, and fails the current test case if
         unsuccessful.
 
         response.as_json: standard python dictionary
+
         response.as_xml: as_etree.ElementTree
         """
 
@@ -102,11 +127,27 @@
 
     @staticmethod
     def _encode_json(data):
-        """Returns a JSON-encoded string of the given python dictionary"""
+        """Returns a JSON-encoded string of the given python dictionary
+
+        :param data: python object to be encoded into JSON
+        :returns: string of JSON encoded data
+        """
         return json.dumps(data)
 
     def _decode_response_body(self, response):
-        """Detects response body type, and attempts to decode it"""
+        """Detects response body type, and attempts to decode it
+
+        :param response: :py:class:`httplib.HTTPResponse`
+        :returns: response object with additions:
+
+        If context type is application/json, the response will have an
+        additional attribute ``json`` that will have the decoded JSON
+        result (typically a dict)
+
+        If context type is application/xml, the response will have an
+        additional attribute ``xml`` that will have the an ElementTree
+        result.
+        """
         if response.body != None and response.body.strip():
             if 'application/json' in response.getheader('Content-Type', ''):
                 response.json = self._decode_json(response.body)
diff -Naur keystone/keystone/test/functional/test_auth.py keystone-new/keystone/test/functional/test_auth.py
--- keystone/keystone/test/functional/test_auth.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/functional/test_auth.py	2011-11-15 14:12:31.000000000 -0600
@@ -149,6 +149,9 @@
 
         self.assertEqual(scoped['token']['tenant']['id'], tenant['id'])
         self.assertEqual(scoped['token']['tenant']['name'], tenant['name'])
+        self.assertEqual(scoped['user']['roles'][0]['id'], role['id'])
+        self.assertEqual(scoped['user']['roles'][0]['name'], role['name'])
+        self.assertEqual(scoped['user']['roles'][0]['tenantId'], tenant['id'])
 
         # And an admin should be able to validate that our new token is scoped
         r = self.validate_token(scoped['token']['id'], tenant['id'])
diff -Naur keystone/keystone/test/functional/test_endpoints.py keystone-new/keystone/test/functional/test_endpoints.py
--- keystone/keystone/test/functional/test_endpoints.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/functional/test_endpoints.py	2011-11-15 14:12:31.000000000 -0600
@@ -106,7 +106,7 @@
 
     def test_get_endpoint_templates_using_invalid_auth_token(self):
         self.admin_token = common.unique_str()
-        self.list_endpoint_templates(assert_status=404)
+        self.list_endpoint_templates(assert_status=401)
 
     def test_get_endpoint_templates_xml(self):
         r = self.get_endpoint_templates(assert_status=200, headers={
@@ -130,7 +130,7 @@
 
     def test_get_endpoint_templates_xml_invalid_auth_token(self):
         self.admin_token = common.unique_str()
-        self.get_endpoint_templates(assert_status=404, headers={
+        self.get_endpoint_templates(assert_status=401, headers={
             'Accept': 'application/xml'})
 
 
@@ -162,7 +162,7 @@
     def test_get_endpoint_using_invalid_auth_token(self):
         self.admin_token = common.unique_str()
         self.fetch_endpoint_template(self.endpoint_template['id'],
-            assert_status=404)
+            assert_status=401)
 
     def test_get_endpoint_xml(self):
         r = self.get_endpoint_template(self.endpoint_template['id'],
@@ -258,7 +258,7 @@
     def test_update_endpoint_template_with_invalid_token(self):
         self.admin_token = common.unique_str()
         self.update_endpoint_template(self.endpoint_template['id'],
-            assert_status=404)
+            assert_status=401)
 
     def test_update_invalid_endpoint_template(self):
         self.update_endpoint_template(assert_status=404)
@@ -283,7 +283,7 @@
     def test_endpoint_create_json_using_invalid_token(self):
         self.admin_token = common.unique_str()
         self.create_endpoint_template(service_id=self.service['id'],
-            assert_status=404)
+            assert_status=401)
 
     def test_endpoint_create_json(self):
         self.create_endpoint_template(service_id=self.service['id'],
@@ -367,7 +367,7 @@
             'internalURL="%s" enabled="%s" global="%s"/>') % (
                 common.unique_str(), self.service['id'], common.unique_url(),
                 common.unique_url(), common.unique_url(), True, True)
-        self.post_endpoint_template(as_xml=data, assert_status=404, headers={
+        self.post_endpoint_template(as_xml=data, assert_status=401, headers={
                 'Accept': 'application/xml'})
 
 
@@ -398,7 +398,7 @@
 
     def test_get_tenant_endpoint_xml_using_invalid_auth_token(self):
         self.admin_token = common.unique_str()
-        self.get_tenant_endpoints(self.tenant['id'], assert_status=404,
+        self.get_tenant_endpoints(self.tenant['id'], assert_status=401,
             headers={"Accept": "application/xml"})
 
     def test_get_tenant_endpoint_json(self):
@@ -419,7 +419,7 @@
 
     def test_get_endpoint_json_using_invalid_auth_token(self):
         self.admin_token = common.unique_str()
-        self.get_tenant_endpoints(self.tenant['id'], assert_status=404)
+        self.get_tenant_endpoints(self.tenant['id'], assert_status=401)
 
 
 class DeleteEndpointsTest(EndpointTemplatesTest):
@@ -452,7 +452,7 @@
     def test_delete_endpoint_using_invalid_auth_token(self):
         self.admin_token = common.unique_str()
         self.delete_tenant_endpoint(self.tenant['id'],
-            self.endpoint_template['id'], assert_status=404)
+            self.endpoint_template['id'], assert_status=401)
 
 
 if __name__ == '__main__':
diff -Naur keystone/keystone/test/functional/test_roles.py keystone-new/keystone/test/functional/test_roles.py
--- keystone/keystone/test/functional/test_roles.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/functional/test_roles.py	2011-11-15 14:12:31.000000000 -0600
@@ -35,7 +35,7 @@
     def test_create_role_using_service_token(self):
         user = self.create_user_with_known_password().json['user']
         self.admin_token = self.authenticate(user['name'], user['password'])
-        self.create_role(assert_status=404)
+        self.create_role(assert_status=401)
 
     def test_create_roles_using_disabled_token(self):
         self.admin_token = self.disabled_admin_token
@@ -51,7 +51,7 @@
 
     def test_create_roles_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.create_role(assert_status=404)
+        self.create_role(assert_status=401)
 
     def test_create_role_mapped_to_a_service(self):
         service = self.create_service().json['OS-KSADM:service']
@@ -102,7 +102,7 @@
 
     def test_delete_roles_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.delete_role(self.role['id'], assert_status=404)
+        self.delete_role(self.role['id'], assert_status=401)
 
     def test_create_and_delete_role_that_has_references(self):
         tenant = self.create_tenant().json['tenant']
@@ -218,11 +218,11 @@
 
     def test_get_role_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.fetch_role(self.role['id'], assert_status=404)
+        self.fetch_role(self.role['id'], assert_status=401)
 
     def test_get_role_xml_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.get_role(self.role['id'], assert_status=404, headers={
+        self.get_role(self.role['id'], assert_status=401, headers={
             'Accept': 'application/xml'})
 
 
@@ -280,7 +280,7 @@
     def test_grant_role_json_using_invalid_token(self):
         self.admin_token = common.unique_str()
         self.grant_role_to_user(self.user['id'], self.role['id'],
-            self.tenant['id'], assert_status=404)
+            self.tenant['id'], assert_status=401)
 
 
 class GetRoleRefsTest(RolesTest):
@@ -332,11 +332,11 @@
 
     def test_get_rolerefs_json_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.get_user_roles(self.user['id'], assert_status=404)
+        self.get_user_roles(self.user['id'], assert_status=401)
 
     def test_get_rolerefs_xml_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.get_user_roles(self.user['id'], assert_status=404, headers={
+        self.get_user_roles(self.user['id'], assert_status=401, headers={
             'Accept': 'application/xml'})
 
 
@@ -381,7 +381,7 @@
     def test_delete_roleref_using_invalid_token(self):
         self.admin_token = common.unique_str()
         self.delete_user_role(self.user['id'], self.roles[0]['id'],
-            assert_status=404)
+            assert_status=401)
 
 
 if __name__ == '__main__':
diff -Naur keystone/keystone/test/functional/test_services.py keystone-new/keystone/test/functional/test_services.py
--- keystone/keystone/test/functional/test_services.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/functional/test_services.py	2011-11-15 14:12:31.000000000 -0600
@@ -71,7 +71,7 @@
 
     def test_get_services_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.list_services(assert_status=404)
+        self.list_services(assert_status=401)
 
 
 class GetServiceTest(ServicesTest):
@@ -109,7 +109,7 @@
 
     def test_get_service_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.fetch_service(service_id=self.service['id'], assert_status=404)
+        self.fetch_service(service_id=self.service['id'], assert_status=401)
 
 
 class CreateServiceTest(ServicesTest):
@@ -160,7 +160,7 @@
 
     def test_service_create_json_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.create_service(assert_status=404)
+        self.create_service(assert_status=401)
 
 
 class DeleteServiceTest(ServicesTest):
@@ -200,7 +200,7 @@
 
     def test_service_delete_json_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.remove_service(self.service['id'], assert_status=404)
+        self.remove_service(self.service['id'], assert_status=401)
 
 
 if __name__ == '__main__':
diff -Naur keystone/keystone/test/functional/test_tenants.py keystone-new/keystone/test/functional/test_tenants.py
--- keystone/keystone/test/functional/test_tenants.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/functional/test_tenants.py	2011-11-15 14:12:31.000000000 -0600
@@ -101,7 +101,7 @@
 
     def test_create_tenant_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.create_tenant(assert_status=404)
+        self.create_tenant(assert_status=401)
 
     def test_create_tenant_invalid_token_xml(self):
         self.admin_token = common.unique_str()
@@ -111,7 +111,7 @@
             <description>A description...</description> \
             </tenant>' % (common.unique_str())
 
-        self.post_tenant(as_xml=data, assert_status=404)
+        self.post_tenant(as_xml=data, assert_status=401)
 
 
 class GetTenantsTest(TenantTest):
diff -Naur keystone/keystone/test/functional/test_token.py keystone-new/keystone/test/functional/test_token.py
--- keystone/keystone/test/functional/test_token.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/functional/test_token.py	2011-11-15 14:12:31.000000000 -0600
@@ -71,17 +71,17 @@
         self.assertEqual(self.role['name'], role.get("name"))
 
     def test_validate_token_expired(self):
-        self.get_token(self.expired_admin_token, assert_status=403)
+        self.get_token(self.expired_admin_token, assert_status=404)
 
     def test_validate_token_expired_xml(self):
-        self.get_token(self.expired_admin_token, assert_status=403, headers={
+        self.get_token(self.expired_admin_token, assert_status=404, headers={
             'Accept': 'application/xml'})
 
     def test_validate_token_invalid(self):
-        self.get_token(common.unique_str(), assert_status=401)
+        self.get_token(common.unique_str(), assert_status=404)
 
     def test_validate_token_invalid_xml(self):
-        self.get_token(common.unique_str(), assert_status=401, headers={
+        self.get_token(common.unique_str(), assert_status=404, headers={
             'Accept': 'application/xml'})
 
 
@@ -104,14 +104,14 @@
             assert_status=200)
 
     def test_validate_token_expired(self):
-        self.check_token(self.expired_admin_token, assert_status=403)
+        self.check_token(self.expired_admin_token, assert_status=404)
 
     def test_validate_token_expired_xml(self):
-        self.check_token(self.expired_admin_token, assert_status=403, headers={
+        self.check_token(self.expired_admin_token, assert_status=404, headers={
             'Accept': 'application/xml'})
 
     def test_validate_token_invalid(self):
-        self.check_token(common.unique_str(), assert_status=401)
+        self.check_token(common.unique_str(), assert_status=404)
 
 
 class TokenEndpointTest(unittest.TestCase):
diff -Naur keystone/keystone/test/functional/test_users.py keystone-new/keystone/test/functional/test_users.py
--- keystone/keystone/test/functional/test_users.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/functional/test_users.py	2011-11-15 14:12:31.000000000 -0600
@@ -68,7 +68,7 @@
 
     def test_create_user_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.create_user(assert_status=404)
+        self.create_user(assert_status=401)
 
 
 class GetUserTest(UserTest):
@@ -78,7 +78,8 @@
         self.user = self.create_user().json['user']
 
     def test_get_user(self):
-        self.fetch_user(self.user['id'])
+        user = self.fetch_user(self.user['id']).json['user']
+        self.assertEqual(self.user['name'], user.get('name'))
 
     def test_query_user(self):
         self.fetch_user_by_name(self.user['name'])
@@ -109,11 +110,11 @@
 
     def test_get_user_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.fetch_user(self.user['id'], assert_status=404)
+        self.fetch_user(self.user['id'], assert_status=401)
 
     def test_query_user_using_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.fetch_user_by_name(self.user['name'], assert_status=404)
+        self.fetch_user_by_name(self.user['name'], assert_status=401)
 
     def test_get_disabled_user(self):
         self.disable_user(self.user['id'])
@@ -144,7 +145,7 @@
 
     def test_user_delete_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.remove_user(self.user['id'], assert_status=404)
+        self.remove_user(self.user['id'], assert_status=401)
 
 
 class GetAllUsersTest(UserTest):
@@ -171,7 +172,7 @@
 
     def test_list_users_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.list_users(assert_status=404)
+        self.list_users(assert_status=401)
 
 
 class UpdateUserTest(UserTest):
@@ -212,7 +213,7 @@
 
     def test_update_user_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.update_user(self.user['id'], assert_status=404)
+        self.update_user(self.user['id'], assert_status=401)
 
     def test_update_user_missing_token(self):
         self.admin_token = ''
@@ -266,7 +267,7 @@
 
     def test_user_password_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.update_user_password(self.user['id'], assert_status=404)
+        self.update_user_password(self.user['id'], assert_status=401)
 
     def test_user_password_missing_token(self):
         self.admin_token = ''
@@ -321,7 +322,7 @@
     def test_update_user_tenant_using_invalid_token(self):
         self.admin_token = common.unique_str()
         self.update_user_tenant(self.user['id'], self.tenant['id'],
-            assert_status=404)
+            assert_status=401)
 
     def test_update_user_tenant_using_disabled_token(self):
         self.admin_token = self.disabled_admin_token
@@ -352,7 +353,7 @@
 
     def test_add_user_tenant_invalid_token(self):
         self.admin_token = common.unique_str()
-        self.create_user(assert_status=404)
+        self.create_user(assert_status=401)
 
     def test_add_user_tenant_missing_token(self):
         self.admin_token = ''
diff -Naur keystone/keystone/test/__init__.py keystone-new/keystone/test/__init__.py
--- keystone/keystone/test/__init__.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/__init__.py	2011-11-15 14:12:31.000000000 -0600
@@ -46,6 +46,18 @@
 
 
 class KeystoneTest(object):
+    """Primary test class for invoking keystone tests. Controls
+    initialization of environment with temporary configuration files,
+    starts keystone admin and service API WSIG servers, and then uses
+    :py:mod:`unittest2` to discover and iterate over existing tests.
+
+    :py:class:`keystone.test.KeystoneTest` is expected to be
+    subclassed and invoked in ``run_tests.py`` where subclasses define
+    a config_name (that matches a template existing in
+    ``keystone/test/etc``) and test_files (that are cleared at the
+    end of test execution from the temporary space used to run these
+    tests).
+    """
     CONF_PARAMS = {'test_dir': TEST_DIR}
 
     def clear_database(self):
diff -Naur keystone/keystone/test/unit/base.py keystone-new/keystone/test/unit/base.py
--- keystone/keystone/test/unit/base.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/unit/base.py	2011-11-15 14:11:29.000000000 -0600
@@ -144,7 +144,7 @@
         """
         Creates a tenant fixture.
 
-        :params **kwargs: Attributes of the tenant to create
+        :params \*\*kwargs: Attributes of the tenant to create
         """
         values = kwargs.copy()
         user = db_api.USER.get_by_name(values['user_name'])
@@ -159,7 +159,7 @@
         """
         Creates a tenant fixture.
 
-        :params **kwargs: Attributes of the tenant to create
+        :params \*\*kwargs: Attributes of the tenant to create
         """
         values = kwargs.copy()
         tenant = db_api.TENANT.create(values)
@@ -171,7 +171,7 @@
         Creates a user fixture. If the user's tenant ID is set, and the tenant
         does not exist in the database, the tenant is created.
 
-        :params **kwargs: Attributes of the user to create
+        :params \*\*kwargs: Attributes of the user to create
         """
         values = kwargs.copy()
         tenant_name = values.get('tenant_name')
@@ -189,7 +189,7 @@
         """
         Creates a token fixture.
 
-        :params **kwargs: Attributes of the token to create
+        :params \*\*kwargs: Attributes of the token to create
         """
         values = kwargs.copy()
         token = db_api.TOKEN.create(values)
diff -Naur keystone/keystone/test/unit/test_server.py keystone-new/keystone/test/unit/test_server.py
--- keystone/keystone/test/unit/test_server.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/test/unit/test_server.py	2011-11-15 14:12:31.000000000 -0600
@@ -20,7 +20,7 @@
         environ = {'wsgi.url_scheme': 'http'}
         self.request = webob.Request(environ)
         self.auth_data = auth.ValidateData(auth.Token(datetime.date.today(),
-            "2231312"), auth.User("id", "username", "12345"))
+            "2231312"), auth.User("id", "username", "12345", "aTenant"))
 
     #def tearDown(self):
 
diff -Naur keystone/keystone/utils.py keystone-new/keystone/utils.py
--- keystone/keystone/utils.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/keystone/utils.py	2011-11-15 14:11:29.000000000 -0600
@@ -120,7 +120,6 @@
         else:
             content = result.to_json()
             resp.headers['content-type'] = "application/json"
-
         resp.content_type_params = {'charset': 'UTF-8'}
         resp.unicode_body = content.decode('UTF-8')
 
diff -Naur keystone/README.md keystone-new/README.md
--- keystone/README.md	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/README.md	2011-11-15 14:11:29.000000000 -0600
@@ -1,109 +1,51 @@
 # Keystone: OpenStack Identity Service
 
-Keystone is a proposed independent authentication service for [OpenStack](http://www.openstack.org).
+Keystone is a Python implementation of the [OpenStack](http://www.openstack.org) identity service API.
 
-This initial proof of concept aims to address the current use cases in Swift and Nova which are:
+# Documentation
 
-* REST-based, token auth for Swift
-* many-to-many relationship between identity and tenant for Nova.
+## For users and sysadmins
 
-# For Users
+Learn how to install, configure, manage, and interact with the OpenStack
+Identity Service API at the [OpenStack Documentation](http://docs.openstack.org/) site.
 
-## User Guide & Concepts
-
-The [`Developer Guide`](https://github.com/openstack/keystone/raw/master/keystone/content/identitydevguide.pdf) 
-documents the APIs to call and how to use them.
-
-#### Core Concepts:
-<table>
-  <tr>
-    <th>Concept</th><th align="left">Description</th>
-  </tr>
-  <tr>
-    <td>User</td><td>An identity stored in the Keystone identity store used by a client to authenticate to Keystone.</td>
-  </tr>
-  <tr>
-    <td>Tenant</td><td>A container which houses multiple resources. <br/>For example, a tenant might represent an 'account' or 'company' which contains an arbitrary number of compute resources. One or more users may be assiciated and have rights to a tenant.</td>
-  </tr>
-  <tr>
-    <td>Role</td><td>A responsibility which is linked to a given user (and optionally scoped to a particular tenant).</td>
-  </tr>
-  <tr>
-    <td>Token</td><td>A 'token' describes a temporary object obtained by clients from Keystone and used to identify themselves to an OpenStack service.</td>
-  </tr>
-</table>
+## For contributors
 
-## Running Keystone
-
-#### Setup
-
-    $ sudo pip install -r tools/pip-requires
-    $ sudo python setup.py install
-
-#### Starting services
-Starting both Admin and Service API endpoints:
-
-    $ ./bin/keystone
-
-### Temporary fix for Segfault
-
-On some OSes, specifically Fedora 15, the current versions of
-greenlet/eventlet segfault when running keystone. To fix this, install
-the development versions of greenlet and eventlet
+Learn how to setup a development environment and then test, run, and contribute to Keystone at the
+[Contributor Documentation](http://keystone.openstack.org/) site.
 
-    $ pip uninstall greenlet eventlet
-    $ cd <appropriate working directory>
-    $ hg clone https://bitbucket.org/ambroff/greenlet
-    $ cd greenlet
-    $ sudo python setup.py install
+# Questions/Feedback
 
-    $ cd <appropriate working directory>
-    $ hg clone https://bitbucket.org/which_linden/eventlet
-    $ cd eventlet
-    $ sudo python setup.py install
+Having trouble? We'd like to help!
 
+* Try the documentation first — it's got answers to many common questions.
+* Search for information in the archives of the [OpenStack mailing list](http://wiki.openstack.org/MailingLists), or post a question.
+* Ask a question in the [#openstack IRC channel](http://wiki.openstack.org/UsingIRC).
+* If you notice errors, please [open a bug](https://bugs.launchpad.net/keystone) and let us know! Please only use the bug tracker for criticisms and improvements. For tech support, use the resources above.
 
-# For Keystone Contributors
+# For Contributors
 
-## Components
+## What's in the box?
 
-#### Services
+### Services
 
 * Keystone    - identity store and authentication service
 * Auth_Token  - WSGI middleware that can be used to handle token auth protocol (WSGI or remote proxy)
 * Echo        - A sample service that responds by returning call details
 
-#### Also included:
+### Also included:
 
-* Keystone    - Service and Admin API are available separately. Admin API allows management of tenants, roles, and users as well.
 * Auth_Basic  - Stub for WSGI middleware that will be used to handle basic auth
 * Auth_OpenID - Stub for WSGI middleware that will be used to handle openid auth protocol (to be implemented)
 * RemoteAuth  - WSGI middleware that can be used in services (like Swift, Nova, and Glance) when Auth middleware is running remotely
 
-#### Built-In commands:
+### Built-In commands:
 
 * bin/keystone  - Provides HTTP API for users and administrators
 * bin/keystone-admin - Provides HTTP API for administrators
 * bin/keystone-service - Provides HTTP API for users
 * bin/keystone-manage - Provides command-line interface for managing all aspects of Keystone
 
-By default, configuration parameters are parsed from `etc/keystone.conf`.
-
-## Dependencies
-
-You may need to prefix your `pip install` commands with `sudo`, depending on your environment.
-
-<pre>
-# Show dependencies
-$ cat tools/pip-requires
-
-# Install dependencies (for production, testing, and development)
-$ pip install -r tools/pip-requires
-
-# Optional: Install Memcache (if enabled as a backend)
-Refer #(http://memcached.org/)
-</pre>
-
 ## Running Keystone
 
 Starting both Admin and Service API endpoints:
@@ -120,57 +62,26 @@
 
 By default, configuration parameters (such as the IP and port binding for each service) are parsed from `etc/keystone.conf`.
 
+## Configuring Keystone
 
-## Running Tests
-
-Before running tests, ensure you have installed the testing dependencies as described in the Dependencies section above.
-
-To run the test suite in a single command:
-
-    $ python keystone/test/run_tests.py
-
-
-#### Sample data
-A set of sample data can be added by running a shell script:
-
-    $ ./bin/sampledata
-
-The script calls `keystone-manage` to create the sample data.
-
-After starting keystone or running `keystone-manage` a `keystone.db` sqlite database should be created in the keystone folder.
-
-
-#### Demo
-To run client demo (with all auth middleware running locally on sample service):
-
-    $ ./examples/echo/bin/echod
-    $ python examples/echo/echo_client.py
-
-
-#### API Validation
-To perform contract validation and load testing, use SoapUI (for now).
+Keystone gets its configuration from command-line parameters or a `.conf` file. While command line parameters take precedence,
+Keystone looks in the following location to find a configuration file:
 
-Using SOAPUI:
+ 1. Command line parameter
+ 2. /etc/keystone.conf
+ 3. /etc/keystone/keystone.conf
+ 4. <topdir>/etc/keystone.conf
 
-1. First, download [SOAPUI](http://sourceforge.net/projects/soapui/files/):
+Additional configuration templates are maintained in `keystone/test/etc/` that may be useful as a reference.
 
-2. To Test Keystone Service:
+### Editing and Building the API Developer Guide
 
-* File->Import Project
-* Select tests/IdentitySOAPUI.xml
-* Double click on "Keystone Tests" and press the green play (>) button
+Users of the Keystone API are often developers making ReSTful API calls to Keystone. The guide to provide them
+information is therefore called a `Developer Guide`. Developer in this case is not to be confused with contributors
+working on the Keystone codebase itself.
 
-
-## Writing Documentation
-
-### Editing and Compiling the Developer Guide
-
-Users of the Keystone API are often developers making ReSTfull calls to Keystone. The guide to provide them
-information is therefore called a `Developer Guide`. Developer in this case is not to be confused with developers
-working on the Keystone source code itself.
-
-The [dev guide](https://github.com/openstack/keystone/raw/master/keystone/content/identitydevguide.pdf) is automatically
-generated from XML and other artifacts that live in the [OpenStack Manuals project](https://launchpad.net/openstack-manuals).
+The developer guides are automatically generated from XML and other artifacts that live in the
+[OpenStack Manuals project](https://launchpad.net/openstack-manuals).
 
 To build the Developer Guide from source, you need [Maven](http://maven.apache.org/). To build the docs and publish a new PDF:
 
@@ -179,48 +90,46 @@
 
 The output will go into the `target` folder (the source is in `src`). Output generated is PDF and webhelp.
 
-### Editing and Compiling the Admin Guide
+# Additional Information:
 
-The Admin guide is written in RST and compiled using sphinx. From the `keystone` folder:
+## Sample data
 
-    $ python setup.py build_sphinx && firefox build/sphinx/html/index.html
+A set of sample data can be loaded by running a shell script:
 
+    $ ./bin/sampledata
 
-## Additional Information:
+The script calls `keystone-manage` to import the sample data.
 
-#### Configuration:
-Keystone gets its configuration from command-line parameters or a .conf file. The file can be provided explicitely
-on the command line otherwise the following logic applies (the conf file in use will be output to help
-in troubleshooting:
+After starting keystone or running `keystone-manage` a `keystone.db` sqlite database should be created in the keystone folder,
+per the default configuration.
 
-1. config.py takes the config file from <topdir>/etc/keystone.conf
-2. If the keystone package is also intalled on the system,
-    /etc/keystone.conf or /etc/keystone/keystone.conf have higher priority than <top_dir>/etc/keystone.conf.
+## Demo
+
+To run client demo (with all auth middleware running locally on sample service):
+
+    $ ./examples/echo/bin/echod
+    $ python examples/echo/echo_client.py
+
+## CURL commands
 
-#### CURL commands
 <pre>
     # Get an unscoped token
-    
     $ curl -d '{"auth": {"passwordCredentials": {"username": "joeuser", "password": "secrete"}}}' -H "Content-type: application/json" http://localhost:5000/v2.0/tokens
 
     # Get a token for a tenant
-
     $ curl -d '{"auth": {"passwordCredentials": {"username": "joeuser", "password": "secrete"}, "tenantName": "customer-x"}}' -H "Content-type: application/json" http://localhost:5000/v2.0/tokens
 
     # Get an admin token
-
     $ curl -d '{"auth": {"passwordCredentials": {"username": "admin", "password": "secrete"}}}' -H "Content-type: application/json" http://localhost:35357/v2.0/tokens
 </pre>
 
-#### Load Testing
+## Load Testing
 
 <pre>
    # Create post data
-
    $ echo '{"auth": {"passwordCredentials": {"username": "joeuser", "password": "secrete", "tenantName": "customer-x"}}}' > post_data
 
    # Call Apache Bench
-
    $ ab -c 30 -n 1000 -T "application/json" -p post_data http://127.0.0.1:35357/v2.0/tokens
 </pre>
 
@@ -335,61 +244,32 @@
 
 But, it works as a demo!
 
-
-## I want OpenStack (all of it)
-
-To get an opinionated install of nova, keystone, dashboard and glance using openstack apis:
-
-    # create a maverick cloud server
-    curl -O https://github.com/cloudbuilders/deploy.sh/raw/master/nova.sh
-    chmod 755 nova.sh
-    export USE_GIT=1         # checkout source using github mirror
-    export ENABLE_VOLUMES=0  # disable volumes
-    export ENABLE_DASH=1     # install & configure dashboard
-    export ENABLE_GLANCE=1   # install & configure glance image service
-    export ENABLE_KEYSTONE=1 # install & configure keystone (unified auth)
-    ./nova.sh branch
-    ./nova.sh install
-    # nova's patched libvirt ppa doesn't work on cloud servers, revert to old libvirt
-    apt-get install -y --force-yes libvirt0=0.8.3-1ubuntu14.1 libvirt-bin=0.8.3-1ubuntu14.1 python-libvirt=0.8.3-1ubuntu14.1
-    ./nova.sh run
-
-
-## Relevant Technologies, Standards, and Links
-
-### Useful links
-
-https://sites.google.com/site/oauthgoog/Overlap
-
-
-### Protocols
-We could potentially integrate with those:
-
-[WebID](http://www.w3.org/2005/Incubator/webid/spec/) - See also: (http://www.w3.org/wiki/Foaf+ssl)
-
-[OpenID](http://openid.net/) and/or [OpenIDConnect](http://openidconnect.com/)
-
-[OAUTH2](http://oauth.net/2/)
-
-[SAML] (http://saml.xml.org/)
-
-### LDAP Setup
-
-#### On a Mac
+## LDAP Setup on a Mac
 
 Using macports:
 
-	sudo port install openldap
+    sudo port install openldap
 
 It appears the package `python-ldap` needs to be recompiled to work. So,
 download it from: http://pypi.python.org/pypi/python-ldap/2.4.1
 
 After unpacking, edit `setup.cfg` as shown below:
 
-	library_dirs = /opt/local/lib
-	include_dirs = /opt/local/include /usr/include/sasl
+    library_dirs = /opt/local/lib
+    include_dirs = /opt/local/include /usr/include/sasl
 
 Then, run:
 
-	python setup.py build
-	sudo python setup.py install
+    python setup.py build
+    sudo python setup.py install
+
+# Relevant Standards and Technologies
+
+[Overlap of Identity Technologies](https://sites.google.com/site/oauthgoog/Overlap)
+
+Keystone could potentially integrate with:
+
+ 1. [WebID](http://www.w3.org/2005/Incubator/webid/spec/) (See also [FOAF+SSL](http://www.w3.org/wiki/Foaf+ssl))
+ 2. [OpenID](http://openid.net/) and/or [OpenIDConnect](http://openidconnect.com/)
+ 3. [OAUTH2](http://oauth.net/2/)
+ 4. [SAML](http://saml.xml.org/)
diff -Naur keystone/run_tests.py keystone-new/run_tests.py
--- keystone/run_tests.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/run_tests.py	2011-11-15 14:12:31.000000000 -0600
@@ -5,16 +5,19 @@
 
 
 class SQLTest(KeystoneTest):
+    """Test defined using only SQLAlchemy back-end"""
     config_name = 'sql.conf.template'
     test_files = ('keystone.db',)
 
 
 class MemcacheTest(KeystoneTest):
+    """Test defined using only SQLAlchemy and Memcache back-end"""
     config_name = 'memcache.conf.template'
     test_files = ('keystone.db',)
 
 
 class LDAPTest(KeystoneTest):
+    """Test defined using only SQLAlchemy and LDAP back-end"""
     config_name = 'ldap.conf.template'
     test_files = ('keystone.db', 'ldap.db', 'ldap.db.db',)
 
diff -Naur keystone/run_tests.sh keystone-new/run_tests.sh
--- keystone/run_tests.sh	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/run_tests.sh	2011-11-15 14:12:31.000000000 -0600
@@ -7,7 +7,6 @@
   echo "  -V, --virtual-env        Always use virtualenv.  Install automatically if not present"
   echo "  -N, --no-virtual-env     Don't use virtualenv.  Run tests in local environment"
   echo "  -f, --force              Force a clean re-build of the virtual environment. Useful when dependencies have been added."
-  echo "  --unittests-only         Run unit tests only, exclude functional tests."
   echo "  --with-coverage          Runs tests with python code coverage (useful for jenkins)"
   echo "                             Note: cannot be used in combination --with-progress"
   echo "  --with-progress          Runs tests with progress (useful for developers)"
@@ -27,11 +26,10 @@
     -h|--help) usage;;
     -V|--virtual-env) let always_venv=1; let never_venv=0;;
     -N|--no-virtual-env) let always_venv=0; let never_venv=1;;
-    -p|--pep8) let just_pep8=1; let never_venv=1;;
+    -p|--pep8) let just_pep8=1;;
     -l|--pylint) let just_pylint=1; let never_venv=0;;
     -f|--force) let force=1;;
-    --unittests-only) noseargs="$noseargs --exclude-dir=keystone/tests/functional --exclude-dir=keystone/tests/system";;
-    *) noseargs="$noseargs $1"
+    *) addlargs="$addlargs $1"
   esac
 }
 
@@ -40,10 +38,11 @@
 always_venv=0
 never_venv=0
 force=0
-noseargs=
+addlargs=
 wrapper=""
 just_pep8=0
 just_pylint=0
+RUNTESTS="python run_tests.py $addlargs"
 
 for arg in "$@"; do
   process_option $arg
@@ -51,7 +50,7 @@
 
 function run_tests {
   # Just run the test suites in current environment
-  ${wrapper} $NOSETESTS
+  ${wrapper} $RUNTESTS
 }
 
 function run_pep8 {
@@ -59,7 +58,7 @@
   PEP8_EXCLUDE="vcsversion.py"
   PEP8_OPTIONS="--exclude=$PEP8_EXCLUDE --repeat --show-pep8 --show-source"
   PEP8_INCLUDE="bin/k* keystone examples tools setup.py run_tests.py"
-  pep8 $PEP8_OPTIONS $PEP8_INCLUDE
+  ${wrapper} pep8 $PEP8_OPTIONS $PEP8_INCLUDE
 }
 
 function run_pylint {
@@ -71,9 +70,6 @@
   echo "Run 'pylint $PYLINT_OPTIONS $PYLINT_INCLUDE' for a full report."
 }
 
-
-NOSETESTS="python run_tests.py $noseargs"
-
 if [ $never_venv -eq 0 ]
 then
   # Remove the virtual environment if --force used
@@ -94,7 +90,7 @@
       if [ "x$use_ve" = "xY" -o "x$use_ve" = "x" -o "x$use_ve" = "xy" ]; then
         # Install the virtualenv and run the test suite in it
         python tools/install_venv.py
-		    wrapper=${with_venv}
+        wrapper=${with_venv}
       fi
     fi
   fi
@@ -111,7 +107,3 @@
 fi
 
 run_tests || exit
-
-#if [ -z "$noseargs" ]; then
-#  run_pep8
-#fi
diff -Naur keystone/setup.py keystone-new/setup.py
--- keystone/setup.py	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/setup.py	2011-11-15 14:11:29.000000000 -0600
@@ -14,9 +14,11 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-from setuptools import setup, find_packages
+import keystone
+import os
+import subprocess
 
-version = '1.0'
+from setuptools import setup, find_packages
 
 cmdclass = {}
 
@@ -28,6 +30,9 @@
 
     class local_BuildDoc(BuildDoc):
         def run(self):
+            base_dir = os.path.dirname(os.path.abspath(__file__))
+            subprocess.Popen(["python", "generate_autodoc_index.py"],
+                             cwd=os.path.join(base_dir, "doc")).communicate()
             for builder in ['html', 'man']:
                 self.builder = builder
                 self.finalize_options()
@@ -39,7 +44,7 @@
 
 setup(
     name='keystone',
-    version=version,
+    version=keystone.canonical_version(),
     description="Authentication service - proposed for OpenStack",
     license='Apache License (2.0)',
     classifiers=["Programming Language :: Python"],
@@ -50,7 +55,8 @@
     include_package_data=True,
     packages=find_packages(exclude=['test', 'bin']),
     scripts=['bin/keystone', 'bin/keystone-auth', 'bin/keystone-admin',
-             'bin/keystone-manage'],
+             'bin/keystone-manage', 'bin/keystone-import',
+             'bin/keystone-control'],
     zip_safe=False,
     cmdclass=cmdclass,
     install_requires=['setuptools'],
diff -Naur keystone/tools/pip-requires keystone-new/tools/pip-requires
--- keystone/tools/pip-requires	2011-11-15 14:08:08.000000000 -0600
+++ keystone-new/tools/pip-requires	2011-11-15 14:11:29.000000000 -0600
@@ -1,6 +1,5 @@
-# You may need to install development files before using 'pip install'
-# For example:
-#   sudo apt-get install python-dev libxml2-dev libxslt1-dev libsasl2-dev libldap2-dev libsqlite3-dev libssl-dev
+# NOTE: You may need to install additional binary packages prior to using 'pip install'
+#       See the Contributor Documentation for more information
 
 # Production
 httplib2 # handles additional HTTP features such as SSL, HEAD/PUT/DELETE, etc
@@ -11,12 +10,13 @@
 webob # wsgi framework
 Routes # URL matching / controller routing
 sqlalchemy # core backend
+sqlalchemy-migrate # database migrations
 pysqlite # default backend database lib
 lxml # xml library providing ElementTree API
 passlib # password hashing
 
 # Optional backend: LDAP
-python-ldap==2.3.13 # authenticate against an existing LDAP server
+python-ldap # authenticate against an existing LDAP server
 
 # Optional backend: Memcache
 python-memcached # increases performance of token validation calls
